<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TRADELINES.SHOP — Demo</title>
<style>
:root{--bg:#f7fbff;--card:#ffffff;--text:#0e2a3f;--muted:#5b7a93;--accent:#0ea5e9;--accent-600:#0284c7;--accent-50:#e0f2fe;--border:#d8e6f3;--table-stripe:#f0f7fd;--danger:#ef4444;--success:#10b981;--warning:#f59e0b}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
.container{max-width:1200px;margin:24px auto;padding:0 16px}
.brand{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.brand-left{display:flex;align-items:center;gap:12px}
.brand-right{display:flex;align-items:center;gap:12px}
.logo{width:12px;height:12px;border-radius:50%;background:var(--accent)}
.brand h1{margin:0;color:var(--accent-600);letter-spacing:.5px;font-weight:700}
.user-info{display:flex;align-items:center;gap:8px}
.user-info span{color:var(--text);font-weight:600}
.cart-icon{display:flex;align-items:center;gap:8px;padding:8px 16px;background:var(--accent);color:#fff;border-radius:20px;cursor:pointer;font-size:14px;font-weight:600}
.cart-icon:hover{background:var(--accent-600)}
.card{background:var(--card);border:1px solid var(--border);border-radius:10px}
.toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;border-bottom:1px solid var(--border)}
.toolbar > *{display:flex;align-items:center}
.toolbar .search{flex:1;min-width:200px}
input[type="text"],select{width:100%;height:36px;border:1px solid var(--border);border-radius:8px;background:#fff;color:var(--text);padding:0 10px;outline:none;min-width:120px}
input[type="text"]::placeholder{color:var(--muted)}
.btn{height:36px;border-radius:8px;border:1px solid var(--accent-600);background:var(--accent);color:#fff;padding:0 12px;cursor:pointer}
.table-wrap{overflow:auto}
table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
thead th{position:sticky;top:0;background:linear-gradient(#fff,var(--card));z-index:1}
th,td{white-space:nowrap;border-bottom:1px solid var(--border);padding:10px 12px}
tbody tr:nth-child(odd){background:var(--table-stripe)}
th{font-weight:600;color:var(--muted);text-align:center}
td{text-align:center}
th.sortable{cursor:pointer}
th.sortable .arrow{margin-left:6px;opacity:.5}
.filters{background:var(--accent-50)}
.filters select{background:#fff}
.filters th{width:auto;min-width:120px;text-align:center}
.filters th:first-child{width:40px;min-width:40px}
.filters th select,.filters th input{display:block;margin:0 auto}
.tag{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--accent-50);border:1px solid var(--border);color:var(--accent-600);font-size:12px}
.actions .btn{background:var(--accent-600);border-color:var(--accent-600)}
.muted{color:var(--muted)}
.footer{display:flex;gap:8px;justify-content:flex-end;padding:12px}
.pill{border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:#fff}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}
.modal-content{background:var(--card);margin:5% auto;padding:0;border-radius:10px;width:90%;max-width:600px;max-height:80vh;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.15)}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid var(--border);background:var(--accent-50)}
.modal-header h2{margin:0;color:var(--accent-600)}
.close{font-size:28px;font-weight:bold;cursor:pointer;color:var(--muted)}
.close:hover{color:var(--text)}
.modal-body{padding:20px;max-height:400px;overflow-y:auto}
.modal-footer{display:flex;gap:12px;justify-content:flex-end;padding:20px;border-top:1px solid var(--border);background:var(--accent-50)}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border:1px solid var(--border);border-radius:8px;margin-bottom:8px;background:#fff}
.cart-item-info{flex:1}
.cart-item-price{font-weight:600;color:var(--accent-600)}
.cart-item-remove{background:var(--danger);color:#fff;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px}
.cart-total{text-align:right;padding:16px;border-top:2px solid var(--border);margin-top:16px;font-size:18px;color:var(--accent-600)}

.form-group{margin-bottom:16px}
.form-group label{display:block;margin-bottom:6px;font-weight:600;color:var(--text)}
.form-group input{width:100%;height:40px;border:1px solid var(--border);border-radius:8px;background:#fff;color:var(--text);padding:0 12px;outline:none;font-size:14px}
.form-group input:focus{border-color:var(--accent);box-shadow:0 0 0 2px rgba(14,165,233,0.1)}
.form-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:24px}
.form-actions .btn{flex:1;max-width:150px}
.form-actions .btn[style*="transparent"]{background:transparent!important;border:1px solid var(--border)!important;color:var(--text)!important}
.form-actions .btn[style*="transparent"]:hover{background:var(--accent-50)!important;border-color:var(--accent)!important;color:var(--accent-600)!important}

.profile-tabs{display:flex;gap:8px;margin-bottom:24px;border-bottom:1px solid var(--border)}
.tab-btn{padding:8px 16px;border:none;background:transparent;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s}
.tab-btn.active{color:var(--accent-600);border-bottom-color:var(--accent-600)}
.tab-btn:hover{color:var(--text)}
.tab-content{display:none}
.tab-content.active{display:block}
.balance-info{text-align:center;padding:24px}
.balance-amount{font-size:32px;font-weight:700;color:var(--accent-600);margin:16px 0}
.payment-section{margin-top:32px;padding:24px;border:1px solid var(--border);border-radius:8px;background:#fff}
.payment-methods{margin-bottom:24px}
.payment-option{display:flex;align-items:center;gap:8px;padding:12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all 0.2s}
.payment-option:hover{background:var(--accent-50)}
.payment-option input[type="radio"]{margin:0}
.zelle-instructions{margin-top:24px}
.zelle-instructions h4{margin-bottom:16px;color:var(--accent-600)}
.payment-details{background:var(--accent-50);padding:16px;border-radius:8px;border:1px solid var(--border)}
.detail-row{margin-bottom:8px;font-size:14px}
.detail-row:last-child{margin-bottom:0}
.please-note{margin-top:24px;padding:16px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px}
.please-note h4{margin-bottom:12px;color:#856404;font-size:16px}
.please-note p{margin-bottom:8px;color:#856404;font-size:14px;line-height:1.4}
.please-note p:last-child{margin-bottom:0}
.cart-summary{margin-bottom:32px;padding:24px;border:1px solid var(--border);border-radius:8px;background:#fff}
.summary-info{margin-bottom:16px}
.summary-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.summary-row:last-child{border-bottom:none;font-weight:600;font-size:16px}
.total-amount{color:var(--accent-600);font-weight:700;font-size:18px}
.orders-list,.payments-list{max-height:400px;overflow-y:auto}
.order-item,.payment-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border:1px solid var(--border);border-radius:8px;margin-bottom:8px;background:#fff}
.order-info,.payment-info{flex:1}
.order-date,.payment-date{color:var(--muted);font-size:12px}
.order-amount,.payment-amount{font-weight:600;color:var(--accent-600)}
.no-data{text-align:center;color:var(--muted);padding:24px;font-style:italic}

.mobile-filters{display:none;padding:12px;background:var(--accent-50);border-bottom:1px solid var(--border)}
.mobile-filter-group{margin-bottom:12px}
.mobile-filter-group:last-child{margin-bottom:0}
.mobile-filter-group label{display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:13px}
.mobile-filter-group select,.mobile-filter-group input{width:100%;height:36px;border:1px solid var(--border);border-radius:8px;background:#fff;color:var(--text);padding:0 10px;outline:none;font-size:14px}
.mobile-cards{display:none}
.mobile-card{background:#fff;border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:12px}
.mobile-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.mobile-card-title{font-weight:600;color:var(--accent-600);font-size:16px}
.mobile-card-price{font-weight:700;color:var(--accent-600);font-size:18px}
.mobile-card-row{display:flex;justify-content:space-between;padding:6px 0;font-size:13px}
.mobile-card-label{color:var(--muted);font-weight:500}
.mobile-card-value{color:var(--text);font-weight:500}
.mobile-card-action{margin-top:12px;padding-top:12px;border-top:1px solid var(--border)}
.mobile-card-action .btn{width:100%}

.loader{display:inline-block;width:20px;height:20px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);display:none;align-items:center;justify-content:center;z-index:2000}
.loading-overlay.active{display:flex}
.skeleton{background:linear-gradient(90deg,var(--border) 25%,var(--table-stripe) 50%,var(--border) 75%);background-size:200% 100%;animation:loading 1.5s ease-in-out infinite;border-radius:4px}
@keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}

.empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
.empty-state-icon{font-size:64px;margin-bottom:16px;opacity:0.5}
.empty-state h3{margin:0 0 8px;color:var(--text);font-size:20px}
.empty-state p{margin:0 0 24px;font-size:14px}


.action-buttons{display:flex;gap:8px;align-items:center}
.btn-icon{display:inline-flex;align-items:center;gap:6px}
.btn-icon svg{width:16px;height:16px}
.favorite-btn,.compare-btn{background:transparent;border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:6px;cursor:pointer;transition:all 0.2s}
.favorite-btn:hover,.compare-btn:hover{background:var(--accent-50);border-color:var(--accent)}
.favorite-btn.active{background:var(--danger);border-color:var(--danger);color:#fff}
.compare-btn.active{background:var(--accent);border-color:var(--accent);color:#fff}

.compare-bar{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:2px solid var(--accent);padding:16px;box-shadow:0 -4px 12px rgba(0,0,0,0.1);z-index:999;transform:translateY(100%);transition:transform 0.3s}
.compare-bar.active{transform:translateY(0)}
.compare-items{display:flex;gap:12px;overflow-x:auto;margin-bottom:12px}
.compare-item{min-width:200px;padding:12px;background:var(--accent-50);border-radius:8px;border:1px solid var(--border)}
.compare-item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.compare-item-title{font-weight:600;color:var(--accent-600)}
.compare-item-remove{background:var(--danger);color:#fff;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px}

.color-picker{display:flex;gap:8px;align-items:center;padding:8px 12px;background:var(--accent-50);border:1px solid var(--border);border-radius:8px}
.color-option{width:32px;height:32px;border-radius:50%;border:2px solid var(--border);cursor:pointer;transition:transform 0.2s}
.color-option:hover{transform:scale(1.1)}
.color-option.active{border-color:var(--text);box-shadow:0 0 0 2px var(--accent)}

.history-section,.favorites-section{margin-top:24px;padding:16px;background:var(--card);border:1px solid var(--border);border-radius:8px}
.history-item,.favorite-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.2s}
.history-item:hover,.favorite-item:hover{background:var(--accent-50)}
.history-item:last-child,.favorite-item:last-child{border-bottom:none}

.export-buttons{display:flex;gap:8px;align-items:center}
.export-btn{display:inline-flex;align-items:center;gap:6px;height:36px;padding:0 16px;background:var(--success);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:14px;transition:background 0.2s;white-space:nowrap}
.export-btn:hover{background:#059669}
th .export-btn{vertical-align:middle;width:100%;max-width:100%}
.filters th .export-btn{display:block;margin:0 auto}



.typo-h1{font-size:32px;font-weight:700;line-height:1.2;letter-spacing:-0.5px}
.typo-h2{font-size:24px;font-weight:600;line-height:1.3}
.typo-h3{font-size:20px;font-weight:600;line-height:1.4}
.typo-body{font-size:14px;line-height:1.6}
.typo-small{font-size:12px;line-height:1.5}

.tooltip{position:relative}
.tooltip::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);padding:6px 10px;background:var(--text);color:var(--card);border-radius:4px;font-size:12px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity 0.2s;margin-bottom:6px}
.tooltip:hover::after{opacity:1}

.scroll-to-top{position:fixed;bottom:24px;right:24px;width:48px;height:48px;background:var(--accent);color:#fff;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:10000;transition:all 0.3s;opacity:0;transform:translateY(20px);pointer-events:none}
.scroll-to-top.visible{opacity:1;transform:translateY(0);pointer-events:auto}
.scroll-to-top:hover{background:var(--accent-600);transform:translateY(-4px);box-shadow:0 6px 16px rgba(0,0,0,0.2)}
@media (max-width:768px){
  .scroll-to-top{bottom:16px;right:16px;width:44px;height:44px;font-size:20px}
}

@media (max-width:768px){
  .container{padding:0 8px;margin:12px auto}
  .brand{flex-direction:row;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px}
  .brand-left{flex:1;min-width:0}
  .brand-right{flex-shrink:0;display:flex;align-items:center;gap:8px}
  .brand h1{font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .cart-icon{font-size:12px;padding:6px 12px}
  .toolbar{flex-direction:column;gap:8px;padding:12px}
  .toolbar .search{width:100%;min-width:100%}
  .toolbar select,.toolbar input{width:100%;min-width:100%}
  .desktop-reset{display:none}
  .table-wrap{display:none}
  .mobile-filters{display:block;padding:12px}
  .mobile-filter-group{margin-bottom:10px}
  .mobile-filter-reset{margin-top:8px}
  .mobile-cards{display:block;padding:12px}
  thead{display:none}
  .modal-content{width:95%;margin:5% auto;max-height:90vh}
  .modal-header,.modal-footer{padding:16px}
  .modal-body{padding:16px;max-height:calc(90vh - 120px)}
  .modal-footer{flex-direction:column}
  .modal-footer .btn{width:100%;max-width:100%}
  .form-actions{flex-direction:column}
  .form-actions .btn{width:100%;max-width:100%}
  .cart-item{flex-direction:column;align-items:flex-start;gap:8px}
  .cart-item-info{width:100%}
  .profile-tabs{flex-wrap:wrap}
  .tab-btn{font-size:12px;padding:6px 12px}
  .user-info{flex-wrap:wrap;gap:8px}
  .user-info button{font-size:12px;padding:6px 10px}
  .footer{padding:12px}
}

@media (max-width:480px){
  .container{padding:0 8px;margin:8px auto}
  .brand{flex-direction:row;align-items:center;gap:6px;margin-bottom:10px}
  .brand-left{flex:1;min-width:0}
  .brand-right{flex-shrink:0;display:flex;align-items:center;gap:4px}
  .brand h1{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .cart-icon{font-size:11px;padding:5px 8px}
  .cart-icon span{margin-left:3px}
  .auth-buttons{display:flex;gap:4px}
  .auth-buttons .btn{font-size:11px;padding:0 8px;height:32px}
  .toolbar{padding:10px}
  .mobile-cards{padding:8px}
  .mobile-card{padding:10px;margin-bottom:10px}
  .mobile-card-title{font-size:15px}
  .mobile-card-price{font-size:16px}
  .mobile-card-row{font-size:12px;padding:5px 0}
  .btn{font-size:12px;padding:0 12px;height:36px}
  .modal-content{width:98%;margin:2% auto}
  .modal-header h2{font-size:18px}
  .close{font-size:24px}
  .form-group input{height:36px;font-size:13px}
  .cart-item{font-size:12px}
  .cart-total{font-size:16px}
  .footer{flex-wrap:wrap;justify-content:center;padding:10px}
  .pill{font-size:12px;padding:4px 8px}
  .balance-amount{font-size:24px}
  .payment-section{padding:16px}
  .cart-summary{padding:16px}
  .user-info{flex-direction:column;align-items:flex-start;gap:8px}
  .user-info button{width:100%;font-size:11px;padding:6px 8px}
}
</style>
</head>
<body>
<div class="container">
<div class="brand">
  <div class="brand-left">
    <div class="logo"></div>
    <h1>TRADELINES.SHOP</h1>
  </div>
  <div class="brand-right">
    <div class="user-info" id="userInfo" style="display:none;">
      <span id="userName"></span>
      <button id="profileBtn" class="btn" style="background:var(--muted);border-color:var(--muted);margin-left:8px;">Profile</button>
      <button id="logoutBtn" class="btn" style="background:var(--danger);border-color:var(--danger);margin-left:8px;">Logout</button>
    </div>
    <div class="auth-buttons" id="authButtons">
      <button id="loginBtn" class="btn" style="background:var(--muted);border-color:var(--muted);margin-right:8px;">Login</button>
      <button id="registerBtn" class="btn">Register</button>
    </div>
    <button id="favoritesBtn" class="btn" style="background:var(--warning);border-color:var(--warning);margin-right:8px;" title="Favorites">⭐</button>
    <button id="historyBtn" class="btn" style="background:var(--muted);border-color:var(--muted);margin-right:8px;" title="View History">📜</button>
    <div class="cart-icon" id="cartIcon">🛒 <span id="cartCount">0</span></div>
  </div>
</div>
<div class="card">
  <div class="toolbar">
    <div class="search">
      <input id="searchInput" type="text" placeholder="Search by bank, limit, statement day...">
    </div>
    <button id="resetFilters" class="btn desktop-reset">Reset</button>
  </div>
  <div class="table-wrap">
    <table id="linesTable">
      <thead>
        <tr>
          <th class="sortable" data-key="lender">Lender <span class="arrow">⇅</span></th>
          <th class="sortable" data-key="limit">Limit <span class="arrow">⇅</span></th>
          <th class="sortable" data-key="statementDay">Statement Day <span class="arrow">⇅</span></th>
          <th class="sortable" data-key="posting">Posting Day <span class="arrow">⇅</span></th>
          <th class="sortable" data-key="ageMonths">Account Age <span class="arrow">⇅</span></th>
          <th class="sortable" data-key="price">Price <span class="arrow">⇅</span></th>
            <th>Actions</th>
        </tr>
        <tr class="filters">
          <th><select id="lenderSelect"><option value="">Select</option><option>CITIBANK</option><option>ELAN</option><option>CHASE</option><option>USBANK</option><option>DISCOVER</option><option>PNC</option><option>Bank of America</option><option>BARCLAYS</option><option>CAPITAL ONE</option><option>TD BANK</option></select></th>
          <th><select id="limitSelect"><option value="">Select Range</option><option>$1,000 - $5,000</option><option>$5,001 - $10,000</option><option>$10,001 - $15,000</option><option>$15,001 - $20,000</option><option>$20,001 - $30,000</option><option>$30,000 - $50,000</option><option>$50,001 +</option></select></th>
          <th><select id="statementSelect"><option value="">Select</option><option>01st</option><option>02nd</option><option>03rd</option><option>04th</option><option>05th</option><option>06th</option><option>07th</option><option>08th</option><option>09th</option><option>10th</option><option>11th</option><option>12th</option><option>13th</option><option>14th</option><option>15th</option><option>16th</option><option>17th</option><option>18th</option><option>19th</option><option>20th</option><option>21st</option><option>22nd</option><option>23rd</option><option>24th</option><option>25th</option><option>26th</option><option>27th</option><option>28th</option><option>29th</option><option>30th</option><option>31st</option></select></th>
          <th><input id="postingInput" type="text" placeholder="напр. Nov 24,2025"></th>
          <th><select id="ageSelect"><option value="">Select Range</option><option>0 - 3</option><option>4 - 10</option><option>11 - 18</option><option>19 - 25</option><option>25 +</option></select></th>
          <th><select id="priceSelect"><option value="">Select Range</option><option>$100 - $500</option><option>$501 - $750</option><option>$751 - $1150</option><option>$1150 +</option></select></th>
          <th><button id="exportCSV" class="export-btn">📥 Export CSV</button></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="mobile-filters" id="mobileFilters">
    <div class="mobile-filter-group">
      <label>Lender:</label>
      <select id="mobileLenderSelect"><option value="">Select</option><option>CITIBANK</option><option>ELAN</option><option>CHASE</option><option>USBANK</option><option>DISCOVER</option><option>PNC</option><option>Bank of America</option><option>BARCLAYS</option><option>CAPITAL ONE</option><option>TD BANK</option></select>
    </div>
    <div class="mobile-filter-group">
      <label>Limit:</label>
      <select id="mobileLimitSelect"><option value="">Select Range</option><option>$1,000 - $5,000</option><option>$5,001 - $10,000</option><option>$10,001 - $15,000</option><option>$15,001 - $20,000</option><option>$20,001 - $30,000</option><option>$30,000 - $50,000</option><option>$50,001 +</option></select>
    </div>
    <div class="mobile-filter-group">
      <label>Statement Day:</label>
      <select id="mobileStatementSelect"><option value="">Select</option><option>01st</option><option>02nd</option><option>03rd</option><option>04th</option><option>05th</option><option>06th</option><option>07th</option><option>08th</option><option>09th</option><option>10th</option><option>11th</option><option>12th</option><option>13th</option><option>14th</option><option>15th</option><option>16th</option><option>17th</option><option>18th</option><option>19th</option><option>20th</option><option>21st</option><option>22nd</option><option>23rd</option><option>24th</option><option>25th</option><option>26th</option><option>27th</option><option>28th</option><option>29th</option><option>30th</option><option>31st</option></select>
    </div>
    <div class="mobile-filter-group">
      <label>Posting Day:</label>
      <input id="mobilePostingInput" type="text" placeholder="напр. Nov 24,2025">
    </div>
    <div class="mobile-filter-group">
      <label>Account Age:</label>
      <select id="mobileAgeSelect"><option value="">Select Range</option><option>0 - 3</option><option>4 - 10</option><option>11 - 18</option><option>19 - 25</option><option>25 +</option></select>
    </div>
    <div class="mobile-filter-group">
      <label>Price:</label>
      <select id="mobilePriceSelect"><option value="">Select Range</option><option>$100 - $500</option><option>$501 - $750</option><option>$751 - $1150</option><option>$1150 +</option></select>
    </div>
    <div class="mobile-filter-reset">
      <button id="mobileResetFilters" class="btn" style="width:100%">Reset</button>
    </div>
  </div>
  <div class="mobile-cards" id="mobileCards"></div>
  <div class="footer"><div class="pill"><span class="muted">Total records:</span> <span id="totalCount">0</span></div></div>
</div>
</div>

<div id="cartModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Cart</h2>
      <span class="close" id="closeCart">&times;</span>
    </div>
    <div class="modal-body">
      <div id="cartItems"></div>
      <div class="cart-total">
        <strong>Total: $<span id="cartTotal">0.00</span></strong>
      </div>
    </div>
    <div class="modal-footer">
      <button id="clearCart" class="btn" style="background:var(--danger);border-color:var(--danger)">Clear Cart</button>
      <button id="checkout" class="btn">Checkout</button>
    </div>
  </div>
</div>

<div id="loginModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Login</h2>
      <span class="close" id="closeLogin">&times;</span>
    </div>
    <div class="modal-body">
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">Email:</label>
          <input type="email" id="loginEmail" required>
        </div>
        <div class="form-group">
          <label for="loginPhone">Phone Number:</label>
          <input type="tel" id="loginPhone" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">Password:</label>
          <input type="password" id="loginPassword" required>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn">Login</button>
          <button type="button" id="showRegister" class="btn" style="background:transparent;border-color:var(--border);color:var(--text)">Don't have an account?</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="registerModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Registration</h2>
      <span class="close" id="closeRegister">&times;</span>
    </div>
    <div class="modal-body">
      <form id="registerForm">
        <div class="form-group">
          <label for="regFirstName">First Name:</label>
          <input type="text" id="regFirstName" required>
        </div>
        <div class="form-group">
          <label for="regLastName">Last Name:</label>
          <input type="text" id="regLastName" required>
        </div>
        <div class="form-group">
          <label for="regPhone">Phone Number:</label>
          <input type="tel" id="regPhone" required>
        </div>
        <div class="form-group">
          <label for="regEmail">Email:</label>
          <input type="email" id="regEmail" required>
        </div>
        <div class="form-group">
          <label for="regPassword">Password:</label>
          <input type="password" id="regPassword" required minlength="6">
        </div>
        <div class="form-group">
          <label for="regConfirmPassword">Confirm Password:</label>
          <input type="password" id="regConfirmPassword" required>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn">Register</button>
          <button type="button" id="showLogin" class="btn" style="background:transparent;border-color:var(--border);color:var(--text)">Already have an account?</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="profileModal" class="modal">
  <div class="modal-content" style="max-width:800px;">
    <div class="modal-header">
      <h2>Profile</h2>
      <span class="close" id="closeProfile">&times;</span>
    </div>
    <div class="modal-body">
      <div class="profile-tabs">
        <button class="tab-btn active" data-tab="balance">Balance</button>
        <button class="tab-btn" data-tab="orders">Orders</button>
      </div>
      
      <div id="balanceTab" class="tab-content active">
        <div class="cart-summary">
          <h3>Cart Summary</h3>
          <div class="summary-info">
            <div class="summary-row">
              <span>Items in cart:</span>
              <span id="cartItemsCount">0</span>
            </div>
            <div class="summary-row">
              <span>Total Amount:</span>
              <span class="total-amount">$<span id="cartTotalAmount">0.00</span></span>
            </div>
          </div>
          <button id="sendConfirmationBtn" class="btn" style="width:100%;margin-top:16px;">Send Confirmation</button>
        </div>
        
        <div class="payment-section">
          <h3>Payment Options</h3>
          <div class="payment-methods">
            <label class="payment-option">
              <input type="radio" name="paymentMethod" value="zelle" checked>
              <span>Zelle (Same-day Transfer)</span>
            </label>
          </div>
          
          <div class="zelle-instructions">
            <h4>Zelle Payment Instructions</h4>
            <div class="payment-details">
              <div class="detail-row">
                <strong>Name:</strong> ZHART LLC
              </div>
              <div class="detail-row">
                <strong>Phone:</strong> 2245844005
              </div>
            </div>
          </div>
          
          <div class="please-note">
            <h4>Please Note</h4>
            <p>For same-day account credit, upload transfer confirmation under Proof of Payment. Contact your bank directly to learn more about their sending limits through Zelle</p>
          </div>
        </div>
      </div>
      
      <div id="ordersTab" class="tab-content">
        <h3>Order History</h3>
        <div id="ordersList" class="orders-list">
          <p class="no-data">No orders yet</p>
        </div>
      </div>
      
    </div>
  </div>
</div>

<div id="addFundsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Funds</h2>
      <span class="close" id="closeAddFunds">&times;</span>
    </div>
    <div class="modal-body">
      <form id="addFundsForm">
        <div class="form-group">
          <label for="amount">Amount ($):</label>
          <input type="number" id="amount" min="10" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="paymentMethod">Payment Method:</label>
          <select id="paymentMethod" required>
            <option value="zelle" selected>Zelle (Same-day Transfer)</option>
            <option value="card">Credit Card</option>
            <option value="paypal">PayPal</option>
            <option value="crypto">Cryptocurrency</option>
          </select>
        </div>
        <div class="zelle-info" style="background:var(--accent-50);padding:12px;border-radius:8px;margin-top:12px;font-size:14px;">
          <strong>Zelle Payment Details:</strong><br>
          <strong>Name:</strong> ZHART LLC<br>
          <strong>Phone:</strong> 2245844005
        </div>
        <div class="form-actions">
          <button type="submit" class="btn">Add Funds</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="confirmationModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Confirmation</h2>
      <span class="close" id="closeConfirmation">&times;</span>
    </div>
    <div class="modal-body" style="text-align:center;padding:40px 20px;">
      <p style="font-size:18px;color:var(--text);margin:0;">The confirmation has been sent. Our manager will contact you shortly.</p>
    </div>
    <div class="modal-footer">
      <button id="okConfirmation" class="btn" style="width:100%;">OK</button>
    </div>
  </div>
</div>

<div class="compare-bar" id="compareBar">
  <div class="compare-items" id="compareItems"></div>
  <div style="display:flex;gap:8px;justify-content:flex-end;">
    <button id="clearCompare" class="btn" style="background:var(--danger);border-color:var(--danger);">Clear All</button>
    <button id="compareNow" class="btn">Compare Selected</button>
  </div>
</div>

<div id="compareModal" class="modal">
  <div class="modal-content" style="max-width:900px;">
    <div class="modal-header">
      <h2>Compare Tradelines</h2>
      <span class="close" id="closeCompare">&times;</span>
    </div>
    <div class="modal-body">
      <div id="compareTable"></div>
    </div>
  </div>
</div>

<div id="favoritesModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>⭐ Favorites</h2>
      <span class="close" id="closeFavorites">&times;</span>
    </div>
    <div class="modal-body">
      <div id="favoritesList" class="favorites-section"></div>
    </div>
  </div>
</div>

<div id="historyModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>📜 View History</h2>
      <span class="close" id="closeHistory">&times;</span>
    </div>
    <div class="modal-body">
      <div id="historyList" class="history-section"></div>
    </div>
  </div>
</div>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loader"></div>
</div>

<script>
function parseAge(ageStr) {
  const yearsMatch = ageStr.match(/(\d+)\s*Years?/);
  const monthsMatch = ageStr.match(/(\d+)\s*Months?/);
  const years = yearsMatch ? parseInt(yearsMatch[1]) : 0;
  const months = monthsMatch ? parseInt(monthsMatch[1]) : 0;
  return years * 12 + months;
}

function extractStatementDay(dateStr) {
  const match = dateStr.match(/(\d+)(st|nd|rd|th)/);
  if (match) {
    const day = parseInt(match[1]);
    const suffix = match[2];
    return (day < 10 ? '0' : '') + day + suffix;
  }
  return dateStr;
}

function parseMoney(str) {
  return parseFloat(str.replace(/[$,]/g, ''));
}

function parseSpots(str) {
  const match = str.match(/(\d+)\s*spot/);
  return match ? parseInt(match[1]) : 1;
}

const rawData = `1 spot	$40,000	Nov 24th	Dec 1st - Dec 9th	10 Years 12 Months	$910	2	ID: 30940

	CITIBANK

2 spots	$5,000	Nov 24th	Dec 1st - Dec 9th	8 Years 6 Months	$350	2	

ID: 30579

	USBANK

1 spot	$20,100	Nov 24th	Dec 1st - Dec 9th	11 Years 12 Months	$550	2	ID: 30658

	DISCOVER

1 spot	$15,900	Nov 24th	Dec 1st - Dec 9th	10 Years 5 Months	$480	2	

ID: 30856

	PNC

1 spot	$14,000	Nov 24th	Dec 1st - Dec 9th	4 Years 2 Months	$445	3	

ID: 30303

	CHASE

1 spot	$34,800	Nov 24th	Dec 1st - Dec 9th	6 Years 1 Months	$629

Original Price: $740	4	ID: 31044

	BARCLAYS

2 spots	$21,000	Nov 24th	Dec 1st - Dec 9th	4 Years 11 Months	$430	2	

ID: 30731

	CHASE

1 spot	$21,000	Nov 24th	Dec 1st - Dec 9th	2 Years 3 Months	$690	4	

ID: 31048

	DISCOVER

1 spot	$17,000	Nov 24th	Dec 1st - Dec 9th	12 Years 12 Months	$540	2	ID: 31053

	USBANK

2 spots	$18,000	Nov 25th	Dec 2nd - Dec 10th	8 Years 11 Months	$485.50	2	

ID: 31028

	USBANK

1 spot	$30,000	Nov 25th	Dec 2nd - Dec 10th	7 Years 4 Months	$558

Original Price: $620	2	

ID: 30931

	USBANK

1 spot	$16,200	Nov 25th	Dec 2nd - Dec 10th	10 Years 0 Months	$470	2	ID: 30824

	USBANK

1 spot	$10,000	Nov 25th	Dec 2nd - Dec 10th	4 Years 1 Months	$310	2	

ID: 30303

	USBANK

1 spot	$20,000	Nov 25th	Dec 2nd - Dec 10th	4 Years 6 Months	$369

Original Price: $410	2	

ID: 30717

	USBANK

1 spot	$21,400	Nov 25th	Dec 2nd - Dec 10th	8 Years 4 Months	$468

Original Price: $520	2	

ID: 31028

	CITIBANK

1 spot	$35,000	Nov 26th	Dec 3rd - Dec 11th	10 Years 1 Months	$675	2	ID: 30930

	CHASE

1 spot	$8,500	Nov 26th	Dec 3rd - Dec 11th	12 Years 3 Months	$530	4	ID: 30809

	USBANK

1 spot	$22,000	Nov 26th	Dec 3rd - Dec 11th	13 Years 1 Months	$535.50

Original Price: $595	2	

ID: 30894

	ELAN

1 spot	$28,000	Nov 26th	Dec 3rd - Dec 11th	14 Years 9 Months	$603

Original Price: $670	2	

ID: 30991

	Bank of America

1 spot	$20,100	Nov 26th	Dec 3rd - Dec 11th	9 Years 5 Months	$685	4	

ID: 31018

	ELAN

2 spots	$4,000	Nov 26th	Dec 3rd - Dec 11th	3 Years 9 Months	$295	2	

ID: 30678

	CITIBANK

1 spot	$23,000	Nov 27th	Dec 4th - Dec 12th	19 Years 9 Months	$750.40	2	ID: 30578

	DISCOVER

1 spot	$8,000	Nov 27th	Dec 4th - Dec 12th	2 Years 2 Months	$340	2	

ID: 30678

	CITIBANK

2 spots	$12,000	Nov 28th	Dec 5th - Dec 13th	13 Years 0 Months	$455.10	2	

ID: 30515

	BARCLAYS

2 spots	$3,000	Nov 28th	Dec 5th - Dec 13th	10 Years 7 Months	$355	2	

ID: 30717

	DISCOVER

1 spot	$11,500	Nov 28th	Dec 5th - Dec 13th	12 Years 12 Months	$365.50

Original Price: $430	2	

ID: 30983

	CAPITAL ONE

1 spot	$31,000	Nov 28th	Dec 5th - Dec 13th	7 Years 0 Months	$629

Original Price: $740	4	

ID: 30983

	BARCLAYS

1 spot	$30,000	Nov 28th	Dec 5th - Dec 13th	8 Years 0 Months	$527

Original Price: $620	2	

ID: 30847

	BARCLAYS

1 spot	$40,250	Nov 28th	Dec 5th - Dec 13th	7 Years 7 Months	$675.75

Original Price: $795	2	

ID: 30931

	CHASE

1 spot	$27,600	Nov 28th	Dec 5th - Dec 13th	6 Years 3 Months	$612

Original Price: $720	4	

ID: 30766

	CITIBANK

1 spot	$14,000	Nov 28th	Dec 5th - Dec 13th	11 Years 0 Months	$440	2	

ID: 30847

	USBANK

1 spot	$10,000	Nov 28th	Dec 5th - Dec 13th	5 Years 0 Months	$340	2	

ID: 30579

	CITIBANK

2 spots	$19,000	Nov 28th	Dec 5th - Dec 13th	16 Years 12 Months	$670	2	

ID: 30902

	BARCLAYS

1 spot	$27,000	Nov 28th	Dec 5th - Dec 13th	9 Years 7 Months	$600.20	2	

ID: 30747

	CITIBANK

2 spots	$12,500	Nov 28th	Dec 5th - Dec 13th	9 Years 3 Months	$410.10	2	

ID: 30991

	CHASE

1 spot	$31,200	Nov 28th	Dec 5th - Dec 13th	4 Years 3 Months	$607.50

Original Price: $675	4	ID: 30935

	CHASE

1 spot	$11,800	Nov 28th	Dec 5th - Dec 13th	13 Years 2 Months	$514.89

Original Price: $605.75	4	

ID: 31012

	DISCOVER

1 spot	$10,500	Nov 28th	Dec 5th - Dec 13th	3 Years 6 Months	$283.50

Original Price: $315	2	ID: 31020

	NFCU

1 spot	$37,000	Nov 28th	Dec 5th - Dec 13th	3 Years 7 Months	$629

Original Price: $740	3	ID: 30986

	DISCOVER

2 spots	$8,500	Nov 28th	Dec 5th - Dec 13th	3 Years 0 Months	$430	2	ID: n/a

	CHASE

1 spot	$63,100	Dec 1st	Dec 8th - Dec 16th	21 Years 3 Months	$1,299.65

Original Price: $1,529	4	

ID: 30539

	CHASE

1 spot	$41,000	Dec 1st	Dec 8th - Dec 16th	18 Years 1 Months	$993.65

Original Price: $1,169	4	

ID: 30539

	CHASE

1 spot	$10,505	Dec 1st	Dec 8th - Dec 16th	8 Years 7 Months	$467.50

Original Price: $550	4	

ID: 30727

	BARCLAYS

1 spot	$24,000	Dec 1st	Dec 8th - Dec 16th	10 Years 4 Months	$501.50

Original Price: $590	2	ID: 30475

	BARCLAYS

2 spots	$33,000	Dec 1st	Dec 8th - Dec 16th	7 Years 1 Months	$480.25

Original Price: $565	2	

ID: 30732

	DISCOVER

1 spot	$3,500	Dec 1st	Dec 8th - Dec 16th	5 Years 0 Months	$285	2	

ID: 30672

	DISCOVER

1 spot	$3,000	Dec 1st	Dec 8th - Dec 16th	5 Years 0 Months	$280	2	

ID: 30672

	TD BANK

1 spot	$1,000	Dec 1st	Dec 8th - Dec 16th	4 Years 11 Months	$245	2	

ID: 30672

	DISCOVER

1 spot	$9,800	Dec 1st	Dec 8th - Dec 16th	8 Years 6 Months	$328.50

Original Price: $365	2	

ID: 30589

	PNC

1 spot	$20,000	Dec 1st	Dec 8th - Dec 16th	5 Years 1 Months	$595	3	

ID: 30678

	PNC

1 spot	$15,000	Dec 1st	Dec 8th - Dec 16th	4 Years 3 Months	$378.25

Original Price: $445	3	

ID: 30579

	DISCOVER

1 spot	$10,000	Dec 1st	Dec 8th - Dec 16th	8 Years 4 Months	$314.50

Original Price: $370	2	ID: 31013

	BARCLAYS

1 spot	$16,700	Dec 1st	Dec 8th - Dec 16th	3 Years 9 Months	$346.50

Original Price: $385	2	ID: 30733

	CHASE

1 spot	$15,500	Dec 2nd	Dec 9th - Dec 17th	17 Years 3 Months	$727	4	

ID: 30758

	CHASE

1 spot	$21,845	Dec 2nd	Dec 9th - Dec 17th	13 Years 3 Months	$633.25

Original Price: $745	4	

ID: 30727

	BARCLAYS

2 spots	$3,019	Dec 2nd	Dec 9th - Dec 17th	6 Years 7 Months	$315	2	ID: 30582

	CITIBANK

2 spots	$13,500	Dec 2nd	Dec 9th - Dec 17th	10 Years 7 Months	$430	2	

ID: 30562

	CITIBANK

1 spot	$33,100	Dec 2nd	Dec 9th - Dec 17th	6 Years 6 Months	$555.30	2	ID: 31037

	PNC

1 spot	$6,000	Dec 2nd	Dec 9th - Dec 17th	4 Years 6 Months	$346.50

Original Price: $385	3	ID: 31002

	CAPITAL ONE

1 spot	$21,000	Dec 2nd	Dec 9th - Dec 17th	4 Years 0 Months	$476

Original Price: $560	4	

ID: 30312

	CHASE

1 spot	$15,000	Dec 2nd	Dec 9th - Dec 17th	5 Years 3 Months	$490	4	

ID: 30991

	BARCLAYS

2 spots	$22,500	Dec 2nd	Dec 9th - Dec 17th	4 Years 10 Months	$405

Original Price: $450	2	ID: 31001

	DISCOVER

1 spot	$10,500	Dec 2nd	Dec 9th - Dec 17th	6 Years 1 Months	$306

Original Price: $360	2	ID: 31039

	BARCLAYS

1 spot	$10,000	Dec 2nd	Dec 9th - Dec 17th	4 Years 10 Months	$297

Original Price: $330	2	

ID: 30766

	CHASE

1 spot	$20,200	Dec 2nd	Dec 9th - Dec 17th	3 Years 0 Months	$459

Original Price: $540	4	

ID: 30416

	CITIBANK

2 spots	$11,300	Dec 3rd	Dec 10th - Dec 18th	9 Years 9 Months	$620	2	ID: 30452

	DISCOVER

1 spot	$20,900	Dec 3rd	Dec 10th - Dec 18th	9 Years 7 Months	$463.25

Original Price: $545	2	ID: 30485

	DISCOVER

1 spot	$30,900	Dec 3rd	Dec 10th - Dec 18th	8 Years 9 Months	$539.75

Original Price: $635	2	ID: 31003

	BARCLAYS

2 spots	$14,500	Dec 3rd	Dec 10th - Dec 18th	7 Years 5 Months	$364.50

Original Price: $405	2	ID: 30456

	BARCLAYS

2 spots	$12,000	Dec 3rd	Dec 10th - Dec 18th	8 Years 2 Months	$355.50

Original Price: $395	2	

ID: 30991

	CHASE

1 spot	$18,600	Dec 3rd	Dec 10th - Dec 18th	9 Years 10 Months	$585	4	

ID: 30991

	DISCOVER

1 spot	$6,500	Dec 3rd	Dec 10th - Dec 18th	4 Years 3 Months	$295	2	

ID: 30870

	PNC

1 spot	$20,000	Dec 3rd	Dec 10th - Dec 18th	5 Years 0 Months	$510

Original Price: $600	3	

ID: 30951

	BARCLAYS

2 spots	$23,000	Dec 3rd	Dec 10th - Dec 18th	2 Years 1 Months	$375	2	

ID: 30312

	CHASE

1 spot	$38,100	Dec 3rd	Dec 10th - Dec 18th	3 Years 8 Months	$688.50

Original Price: $810	4	ID: 31042

	CITIBANK

2 spots	$6,800	Dec 4th	Dec 11th - Dec 19th	8 Years 11 Months	$365	2	

ID: 30515

	CITIBANK

1 spot	$19,500	Dec 4th	Dec 11th - Dec 19th	9 Years 1 Months	$500.90	2	ID: 30959

	CHASE

1 spot	$40,200	Dec 4th	Dec 11th - Dec 19th	11 Years 4 Months	$882

Original Price: $980	4	

ID: 30416

	CHASE

1 spot	$15,300	Dec 4th	Dec 11th - Dec 19th	4 Years 6 Months	$429.25

Original Price: $505	4	

ID: 30793

	CHASE

2 spots	$26,000	Dec 4th	Dec 11th - Dec 19th	2 Years 2 Months	$569.50

Original Price: $670	4	

ID: 30993

	BARCLAYS

1 spot	$10,000	Dec 4th	Dec 11th - Dec 19th	3 Years 8 Months	$306

Original Price: $340	2	

ID: 30984

	BARCLAYS

2 spots	$39,000	Dec 5th	Dec 12th - Dec 20th	10 Years 10 Months	$629

Original Price: $740	2	

ID: 30539

	CITIBANK

1 spot	$21,200	Dec 5th	Dec 12th - Dec 20th	14 Years 3 Months	$610	2	

ID: 30771

	BARCLAYS

1 spot	$16,500	Dec 5th	Dec 12th - Dec 20th	8 Years 2 Months	$409.50

Original Price: $455	2	

ID: 30771

	BARCLAYS

2 spots	$3,019	Dec 5th	Dec 12th - Dec 20th	7 Years 0 Months	$288

Original Price: $320	2	

ID: 30861

	BARCLAYS

1 spot	$27,500	Dec 5th	Dec 12th - Dec 20th	3 Years 11 Months	$395.25

Original Price: $465	2	ID: 30223

	BARCLAYS

1 spot	$18,000	Dec 5th	Dec 12th - Dec 20th	4 Years 10 Months	$387

Original Price: $430	2	

ID: 30766

	Bank of America

1 spot	$21,500	Dec 5th	Dec 12th - Dec 20th	2 Years 6 Months	$442

Original Price: $520	4	

ID: 31041

	BARCLAYS

2 spots	$1,500	Dec 5th	Dec 12th - Dec 20th	1 Years 7 Months	$185	2	ID: 30978

	BARCLAYS

1 spot	$41,500	Dec 5th	Dec 12th - Dec 20th	2 Years 9 Months	$607.75

Original Price: $715	2	ID: 30875

	BARCLAYS

1 spot	$16,500	Dec 5th	Dec 12th - Dec 20th	2 Years 4 Months	$380	2	ID: 31055

	CITIBANK

1 spot	$16,020	Dec 6th	Dec 13th - Dec 21st	20 Years 10 Months	$645	2	ID: 29

	CITIBANK

1 spot	$20,500	Dec 6th	Dec 13th - Dec 21st	15 Years 2 Months	$590.10	2	

ID: 30546

	CHASE

1 spot	$14,500	Dec 6th	Dec 13th - Dec 21st	13 Years 5 Months	$567

Original Price: $630	4	ID: 31023

	CITIBANK

1 spot	$25,000	Dec 7th	Dec 14th - Dec 22nd	9 Years 9 Months	$585	2	ID: 30926

	BARCLAYS

2 spots	$3,019	Dec 7th	Dec 14th - Dec 22nd	8 Years 6 Months	$333

Original Price: $370	2	ID: 30597

	BARCLAYS

2 spots	$3,019	Dec 7th	Dec 14th - Dec 22nd	6 Years 10 Months	$288

Original Price: $320	2	ID: 30848

	CHASE

2 spots	$24,000	Dec 7th	Dec 14th - Dec 22nd	7 Years 7 Months	$585.18

Original Price: $650.20	4	ID: 30741

	DISCOVER

1 spot	$20,700	Dec 7th	Dec 14th - Dec 22nd	12 Years 0 Months	$450.50

Original Price: $530	2	

ID: 30747

	CAPITAL ONE

1 spot	$30,000	Dec 7th	Dec 14th - Dec 22nd	7 Years 0 Months	$720	4	ID: 30814

	CITIBANK

1 spot	$28,000	Dec 7th	Dec 14th - Dec 22nd	13 Years 9 Months	$660.90	2	ID: 30698

	BARCLAYS

1 spot	$21,000	Dec 7th	Dec 14th - Dec 22nd	6 Years 4 Months	$399.50

Original Price: $470	2	

ID: 30416

	DISCOVER

2 spots	$8,000	Dec 7th	Dec 14th - Dec 22nd	1 Years 0 Months	$175.50

Original Price: $195	2	

ID: 31041

	DISCOVER

1 spot	$20,100	Dec 8th	Dec 15th - Dec 23rd	10 Years 2 Months	$450.50

Original Price: $530	2	

ID: 30720

	CITIBANK

1 spot	$6,600	Dec 8th	Dec 15th - Dec 23rd	8 Years 9 Months	$360.60	2	

ID: 30793

	CITIBANK

2 spots	$22,000	Dec 8th	Dec 15th - Dec 23rd	6 Years 9 Months	$475	2	

ID: 30303

	BARCLAYS

2 spots	$8,000	Dec 8th	Dec 15th - Dec 23rd	6 Years 3 Months	$301.50

Original Price: $335	2	ID: 30782

	DISCOVER

1 spot	$5,000	Dec 8th	Dec 15th - Dec 23rd	6 Years 4 Months	$279

Original Price: $310	2	

ID: 30861

	Alliant CU

1 spot	$21,000	Dec 8th	Dec 15th - Dec 23rd	8 Years 11 Months	$459

Original Price: $540	2	

ID: 30303

	PNC

1 spot	$22,500	Dec 8th	Dec 15th - Dec 23rd	10 Years 6 Months	$522.75

Original Price: $615	3	ID: 30774

	BARCLAYS

1 spot	$25,000	Dec 8th	Dec 15th - Dec 23rd	2 Years 5 Months	$378

Original Price: $420	2	ID: 31047

	CHASE

1 spot	$25,000	Dec 8th	Dec 15th - Dec 23rd	2 Years 4 Months	$603

Original Price: $670	4	

ID: 30919

	BARCLAYS

2 spots	$7,500	Dec 9th	Dec 16th - Dec 24th	6 Years 9 Months	$297

Original Price: $330	2	ID: 30499

	CITIBANK

2 spots	$2,000	Dec 9th	Dec 16th - Dec 24th	7 Years 6 Months	$285	2	ID: 30674

	BARCLAYS

1 spot	$11,772	Dec 9th	Dec 16th - Dec 24th	6 Years 4 Months	$328.50

Original Price: $365	2	

ID: 30755

	BARCLAYS

1 spot	$35,000	Dec 9th	Dec 16th - Dec 24th	7 Years 7 Months	$590.75

Original Price: $695	2	

ID: 30732

	CHASE

1 spot	$7,000	Dec 9th	Dec 16th - Dec 24th	10 Years 12 Months	$505	4	ID: 31032

	BARCLAYS

2 spots	$11,500	Dec 9th	Dec 16th - Dec 24th	11 Years 9 Months	$378

Original Price: $420	2	

ID: 30720

	CITIBANK

1 spot	$32,000	Dec 9th	Dec 16th - Dec 24th	19 Years 10 Months	$810	2	

ID: 30870

	CHASE

2 spots	$28,800	Dec 9th	Dec 16th - Dec 24th	9 Years 3 Months	$590.75

Original Price: $695	4	ID: 31031

	CITIBANK

1 spot	$4,900	Dec 9th	Dec 16th - Dec 24th	4 Years 9 Months	$350	2	

ID: 30579

	CHASE

1 spot	$19,000	Dec 9th	Dec 16th - Dec 24th	7 Years 1 Months	$490.86

Original Price: $545.40	4	

ID: 30894

	CHASE

2 spots	$25,000	Dec 9th	Dec 16th - Dec 24th	9 Years 1 Months	$569.50

Original Price: $670	4	

ID: 30906

	CHASE

1 spot	$86,905	Dec 9th	Dec 16th - Dec 24th	9 Years 2 Months	$1,614.15

Original Price: $1,899	4	ID: 30975

	BARCLAYS

1 spot	$31,100	Dec 9th	Dec 16th - Dec 24th	5 Years 2 Months	$459.76

Original Price: $540.90	2	ID: 30707

	CHASE

2 spots	$18,000	Dec 9th	Dec 16th - Dec 24th	4 Years 11 Months	$437.75

Original Price: $515	4	

ID: 30681

	BARCLAYS

2 spots	$20,000	Dec 9th	Dec 16th - Dec 24th	6 Years 0 Months	$409.50

Original Price: $455	2	

ID: 30943

	BARCLAYS

3 spots	$17,000	Dec 9th	Dec 16th - Dec 24th	2 Years 3 Months	$342

Original Price: $380	2	

ID: 31041

	DISCOVER

1 spot	$20,500	Dec 10th	Dec 17th - Dec 25th	26 Years 3 Months	$803.25

Original Price: $945	2	

ID: 30777

	DISCOVER

2 spots	$6,000	Dec 10th	Dec 17th - Dec 25th	12 Years 7 Months	$440	2	

ID: 30964

	DISCOVER

2 spots	$14,400	Dec 10th	Dec 17th - Dec 25th	9 Years 8 Months	$374

Original Price: $440	2	ID: 30756

	DISCOVER

1 spot	$11,500	Dec 10th	Dec 17th - Dec 25th	17 Years 4 Months	$535.50

Original Price: $595	2	ID: 30860

	CITIBANK

2 spots	$19,000	Dec 10th	Dec 17th - Dec 25th	8 Years 10 Months	$495	2	

ID: 30889

	CITIBANK

1 spot	$22,000	Dec 10th	Dec 17th - Dec 25th	11 Years 0 Months	$560.60	2	

ID: 30890

	CHASE

1 spot	$41,000	Dec 10th	Dec 17th - Dec 25th	10 Years 12 Months	$824.50

Original Price: $970	4	ID: 31005

	DISCOVER

2 spots	$3,500	Dec 11th	Dec 18th - Dec 26th	5 Years 9 Months	$252

Original Price: $280	2	

ID: 30984

	BARCLAYS

2 spots	$23,000	Dec 11th	Dec 18th - Dec 26th	5 Years 10 Months	$437.04

Original Price: $485.60	2	

ID: 30906

	CHASE

2 spots	$26,900	Dec 11th	Dec 18th - Dec 26th	10 Years 5 Months	$630

Original Price: $700	4	

ID: 30861

	CHASE

1 spot	$12,000	Dec 11th	Dec 18th - Dec 26th	5 Years 8 Months	$399.50

Original Price: $470	4	

ID: 30902

	CHASE

1 spot	$28,000	Dec 11th	Dec 18th - Dec 26th	7 Years 5 Months	$711

Original Price: $790	4	

ID: 31048

	CITIBANK

1 spot	$7,300	Dec 12th	Dec 19th - Dec 27th	7 Years 4 Months	$335	2	ID: 30982

	CHASE

2 spots	$18,200	Dec 12th	Dec 19th - Dec 27th	2 Years 5 Months	$450.50

Original Price: $530	4	ID: 31011

	BARCLAYS

1 spot	$21,000	Dec 12th	Dec 19th - Dec 27th	2 Years 0 Months	$375	2	

ID: 31018

	CAPITAL ONE

2 spots	$9,500	Dec 12th	Dec 19th - Dec 27th	4 Years 5 Months	$348.50

Original Price: $410	4	

ID: 31041

	CITIBANK

2 spots	$24,160	Dec 13th	Dec 20th - Dec 28th	21 Years 3 Months	$740	2	ID: 30659

	DISCOVER

1 spot	$10,600	Dec 13th	Dec 20th - Dec 28th	36 Years 5 Months	$930.75

Original Price: $1,095	2	

ID: 30835

	CITIBANK

2 spots	$9,400	Dec 13th	Dec 20th - Dec 28th	7 Years 0 Months	$350.50	2	ID: 30876

	CHASE

2 spots	$17,800	Dec 13th	Dec 20th - Dec 28th	7 Years 11 Months	$467.50

Original Price: $550	4	

ID: 30889

	DISCOVER

1 spot	$35,000	Dec 13th	Dec 20th - Dec 28th	7 Years 11 Months	$569.50

Original Price: $670	2	

ID: 30993

	CAPITAL ONE

1 spot	$10,000	Dec 13th	Dec 20th - Dec 28th	4 Years 1 Months	$382.50

Original Price: $450	4	

ID: 30793

	BARCLAYS

1 spot	$24,000	Dec 13th	Dec 20th - Dec 28th	5 Years 9 Months	$416.50

Original Price: $490	2	

ID: 30777

	CAPITAL ONE

2 spots	$11,000	Dec 13th	Dec 20th - Dec 28th	4 Years 5 Months	$391

Original Price: $460	4	

ID: 31041

	WELLS FARGO

1 spot	$6,000	Dec 14th	Dec 21st - Dec 29th	17 Years 7 Months	$423

Original Price: $470	2	

ID: 30243

	CITIBANK

1 spot	$15,300	Dec 14th	Dec 21st - Dec 29th	10 Years 7 Months	$460	2	ID: 30922

	CHASE

1 spot	$11,000	Dec 14th	Dec 21st - Dec 29th	22 Years 9 Months	$795	4	

ID: 30793

	CHASE

2 spots	$16,000	Dec 14th	Dec 21st - Dec 29th	7 Years 4 Months	$525	4	

ID: 30793

	BARCLAYS

2 spots	$3,019	Dec 14th	Dec 21st - Dec 29th	6 Years 11 Months	$288

Original Price: $320	2	

ID: 30672

	CITIBANK

1 spot	$18,500	Dec 14th	Dec 21st - Dec 29th	20 Years 6 Months	$675	2	

ID: 30771

	CITIBANK

1 spot	$12,000	Dec 14th	Dec 21st - Dec 29th	8 Years 9 Months	$600	2	ID: 30881

	BARCLAYS

1 spot	$12,800	Dec 14th	Dec 21st - Dec 29th	7 Years 7 Months	$337.50

Original Price: $375	2	ID: 30417

	CITIBANK

1 spot	$24,500	Dec 14th	Dec 21st - Dec 29th	9 Years 3 Months	$570	2	ID: 30966

	BARCLAYS

1 spot	$31,000	Dec 14th	Dec 21st - Dec 29th	6 Years 3 Months	$527

Original Price: $620	2	

ID: 30731

	DISCOVER

1 spot	$15,600	Dec 14th	Dec 21st - Dec 29th	5 Years 11 Months	$369

Original Price: $410	2	

ID: 30890

	DISCOVER

1 spot	$3,000	Dec 14th	Dec 21st - Dec 29th	4 Years 0 Months	$250	2	

ID: 30672

	DISCOVER

1 spot	$5,000	Dec 14th	Dec 21st - Dec 29th	4 Years 0 Months	$300	2	

ID: 30672

	BARCLAYS

1 spot	$25,000	Dec 14th	Dec 21st - Dec 29th	3 Years 10 Months	$423

Original Price: $470	2	

ID: 30771

	CHASE

1 spot	$20,000	Dec 15th	Dec 22nd - Dec 30th	18 Years 6 Months	$756.50

Original Price: $890	4	ID: 30845

	CITIBANK

1 spot	$19,400	Dec 15th	Dec 22nd - Dec 30th	7 Years 9 Months	$450.90	2	

ID: 30906

	DISCOVER

1 spot	$18,500	Dec 15th	Dec 22nd - Dec 30th	6 Years 3 Months	$369.75

Original Price: $435	2	ID: 30478

	CHASE

1 spot	$23,000	Dec 15th	Dec 22nd - Dec 30th	5 Years 3 Months	$484.50

Original Price: $570	4	ID: 31021

	Bank of America

2 spots	$12,000	Dec 15th	Dec 22nd - Dec 30th	3 Years 9 Months	$391

Original Price: $460	4	ID: 31017

	CAPITAL ONE

1 spot	$10,000	Dec 16th	Dec 23rd - Dec 31st	8 Years 6 Months	$495

Original Price: $550	4	

ID: 30793

	DISCOVER

1 spot	$16,500	Dec 16th	Dec 23rd - Dec 31st	7 Years 11 Months	$365.50

Original Price: $430	2	

ID: 30448

	BARCLAYS

2 spots	$22,000	Dec 16th	Dec 23rd - Dec 31st	5 Years 9 Months	$423

Original Price: $470	2	

ID: 30769

	Bank of America

1 spot	$20,500	Dec 16th	Dec 23rd - Dec 31st	7 Years 4 Months	$480.42

Original Price: $565.20	4	ID: 30772

	Bank of America

1 spot	$22,000	Dec 16th	Dec 23rd - Dec 31st	6 Years 3 Months	$490.45

Original Price: $577	4	

ID: 30448

	CITIBANK

2 spots	$15,180	Dec 16th	Dec 23rd - Dec 31st	14 Years 3 Months	$550	2	

ID: 30911

	DISCOVER

1 spot	$15,000	Dec 16th	Dec 23rd - Dec 31st	20 Years 5 Months	$690	2	

ID: 30589

	CHASE

1 spot	$17,600	Dec 16th	Dec 23rd - Dec 31st	5 Years 6 Months	$510	4	ID: 30938

	CHASE

1 spot	$21,500	Dec 16th	Dec 23rd - Dec 31st	5 Years 8 Months	$570	4	ID: 30963

	BARCLAYS

2 spots	$10,000	Dec 16th	Dec 23rd - Dec 31st	3 Years 2 Months	$315

Original Price: $350	2	

ID: 30943

	CHASE

1 spot	$29,900	Dec 16th	Dec 23rd - Dec 31st	13 Years 0 Months	$722.50

Original Price: $850	4	

ID: 30873

	BARCLAYS

2 spots	$21,000	Dec 16th	Dec 23rd - Dec 31st	3 Years 3 Months	$355.50

Original Price: $395	2	

ID: 30681

	DISCOVER

1 spot	$21,000	Dec 16th	Dec 23rd - Dec 31st	4 Years 6 Months	$365.50

Original Price: $430	2	

ID: 30835

	BARCLAYS

2 spots	$11,800	Dec 16th	Dec 23rd - Dec 31st	19 Years 8 Months	$558

Original Price: $620	2	ID: 31049

	BARCLAYS

4 spots	$58,000	Dec 16th	Dec 23rd - Dec 31st	2 Years 9 Months	$975	2	ID: 30973

	BARCLAYS

2 spots	$48,200	Dec 16th	Dec 23rd - Dec 31st	2 Years 0 Months	$915	2	

ID: 30303

	CITIBANK

1 spot	$27,000	Dec 17th	Dec 24th - Jan 1st	9 Years 10 Months	$600.20	2	

ID: 30546

	Bank of America

1 spot	$47,100	Dec 17th	Dec 24th - Jan 1st	9 Years 0 Months	$935	4	

ID: 30303

	CHASE

1 spot	$20,445	Dec 17th	Dec 24th - Jan 1st	11 Years 9 Months	$655	4	

ID: 30243

	CITIBANK

2 spots	$15,960	Dec 17th	Dec 24th - Jan 1st	7 Years 8 Months	$490.10	2	

ID: 30911

	CHASE

2 spots	$16,500	Dec 17th	Dec 24th - Jan 1st	5 Years 4 Months	$445.50

Original Price: $495	4	ID: 30877

	CHASE

1 spot	$42,000	Dec 17th	Dec 24th - Jan 1st	9 Years 4 Months	$774

Original Price: $860	4	

ID: 30856

	DISCOVER

1 spot	$1,000	Dec 17th	Dec 24th - Jan 1st	4 Years 0 Months	$240	2	

ID: 30579

	DISCOVER

1 spot	$10,000	Dec 17th	Dec 24th - Jan 1st	4 Years 6 Months	$288

Original Price: $320	2	ID: 30998

	Bank of America

1 spot	$20,000	Dec 17th	Dec 24th - Jan 1st	6 Years 5 Months	$463.25

Original Price: $545	4	

ID: 31012

	PNC

1 spot	$21,000	Dec 18th	Dec 25th - Jan 2nd	11 Years 9 Months	$562.50

Original Price: $625	3	ID: 30699

	BARCLAYS

1 spot	$20,019	Dec 18th	Dec 25th - Jan 2nd	9 Years 7 Months	$482.22

Original Price: $535.80	2	ID: 30948

	CITIBANK

1 spot	$14,000	Dec 18th	Dec 25th - Jan 2nd	5 Years 3 Months	$390.20	2	

ID: 30755

	PNC

1 spot	$19,000	Dec 18th	Dec 25th - Jan 2nd	5 Years 2 Months	$540

Original Price: $600	3	

ID: 30755

	BARCLAYS

2 spots	$38,800	Dec 18th	Dec 25th - Jan 2nd	2 Years 9 Months	$590.75

Original Price: $695	2	

ID: 30678

	CHASE

1 spot	$21,600	Dec 19th	Dec 26th - Jan 3rd	13 Years 5 Months	$633.25

Original Price: $745	4	ID: 30530

	CITIBANK

2 spots	$20,000	Dec 19th	Dec 26th - Jan 3rd	9 Years 5 Months	$515	2	ID: 30858

	CITIBANK

1 spot	$10,100	Dec 19th	Dec 26th - Jan 3rd	10 Years 4 Months	$385	2	

ID: 30793

	BARCLAYS

1 spot	$20,000	Dec 19th	Dec 26th - Jan 3rd	6 Years 2 Months	$414

Original Price: $460	2	

ID: 30755

	BARCLAYS

2 spots	$15,000	Dec 19th	Dec 26th - Jan 3rd	10 Years 9 Months	$405

Original Price: $450	2	

ID: 30565

	BARCLAYS

2 spots	$12,019	Dec 19th	Dec 26th - Jan 3rd	4 Years 9 Months	$315

Original Price: $350	2	ID: 30936

	BARCLAYS

2 spots	$5,019	Dec 19th	Dec 26th - Jan 3rd	8 Years 6 Months	$370	2	

ID: 30964

	BARCLAYS

1 spot	$30,500	Dec 19th	Dec 26th - Jan 3rd	4 Years 11 Months	$442

Original Price: $520	2	

ID: 30835

	PNC

1 spot	$20,000	Dec 19th	Dec 26th - Jan 3rd	4 Years 11 Months	$600	3	

ID: 30951

	CHASE

1 spot	$22,000	Dec 19th	Dec 26th - Jan 3rd	12 Years 0 Months	$569.50

Original Price: $670	4	

ID: 30861

	CITIBANK

2 spots	$17,700	Dec 19th	Dec 26th - Jan 3rd	3 Years 8 Months	$500	2	ID: 30942

	CHASE

2 spots	$6,000	Dec 19th	Dec 26th - Jan 3rd	7 Years 10 Months	$432

Original Price: $480	4	

ID: 31041

	BARCLAYS

1 spot	$19,000	Dec 20th	Dec 27th - Jan 4th	6 Years 11 Months	$395.25

Original Price: $465	2	

ID: 30769

	CITIBANK

1 spot	$22,800	Dec 20th	Dec 27th - Jan 4th	22 Years 0 Months	$770	2	ID: 30776

	BARCLAYS

2 spots	$14,000	Dec 20th	Dec 27th - Jan 4th	7 Years 3 Months	$400	2	ID: 30779

	BARCLAYS

1 spot	$28,200	Dec 20th	Dec 27th - Jan 4th	7 Years 9 Months	$442.76

Original Price: $520.90	2	ID: 30798

	CITIBANK

1 spot	$14,500	Dec 20th	Dec 27th - Jan 4th	10 Years 4 Months	$450.20	2	ID: 30807

	CITIBANK

2 spots	$25,500	Dec 20th	Dec 27th - Jan 4th	9 Years 10 Months	$595	2	ID: 30985

	BARCLAYS

1 spot	$31,000	Dec 20th	Dec 27th - Jan 4th	8 Years 3 Months	$562.50

Original Price: $625	2	ID: 30971

	CITIBANK

1 spot	$22,500	Dec 20th	Dec 27th - Jan 4th	11 Years 2 Months	$560	2	

ID: 30873

	CITIBANK

1 spot	$27,000	Dec 20th	Dec 27th - Jan 4th	9 Years 4 Months	$600	2	

ID: 30720

	CAPITAL ONE

2 spots	$5,000	Dec 20th	Dec 27th - Jan 4th	8 Years 10 Months	$405

Original Price: $450	4	

ID: 30889

	ELAN

1 spot	$7,500	Dec 20th	Dec 27th - Jan 4th	13 Years 6 Months	$440	2	ID: 30900

	CHASE

1 spot	$20,000	Dec 20th	Dec 27th - Jan 4th	6 Years 2 Months	$540.40	4	

ID: 30906

	Bank of America

1 spot	$21,000	Dec 21st	Dec 28th - Jan 5th	8 Years 5 Months	$630	4	

ID: 30448

	BARCLAYS

1 spot	$30,000	Dec 21st	Dec 28th - Jan 5th	8 Years 0 Months	$620	2	

ID: 30562

	BARCLAYS

1 spot	$25,000	Dec 21st	Dec 28th - Jan 5th	9 Years 7 Months	$585.30	2	

ID: 30565

	ELAN

1 spot	$40,000	Dec 21st	Dec 28th - Jan 5th	15 Years 1 Months	$845	2	

ID: 30539

	BARCLAYS

1 spot	$22,000	Dec 21st	Dec 28th - Jan 5th	11 Years 6 Months	$476

Original Price: $560	2	

ID: 30720

	BARCLAYS

1 spot	$25,000	Dec 21st	Dec 28th - Jan 5th	9 Years 0 Months	$471.75

Original Price: $555	2	ID: 31029

	USBANK

2 spots	$2,000	Dec 21st	Dec 28th - Jan 5th	5 Years 0 Months	$275	2	

ID: 30579

	BARCLAYS

2 spots	$31,100	Dec 21st	Dec 28th - Jan 5th	4 Years 10 Months	$446.25

Original Price: $525	2	ID: 31030

	ELAN

1 spot	$25,000	Dec 21st	Dec 28th - Jan 5th	4 Years 2 Months	$432

Original Price: $480	2	ID: 30961

	BARCLAYS

2 spots	$22,000	Dec 21st	Dec 28th - Jan 5th	2 Years 4 Months	$375	2	

ID: 31041

	BARCLAYS

1 spot	$31,700	Dec 22nd	Dec 29th - Jan 6th	3 Years 9 Months	$446.25

Original Price: $525	2	

ID: 30919

	BARCLAYS

2 spots	$21,000	Dec 23rd	Dec 30th - Jan 7th	6 Years 6 Months	$470	2	ID: 30666

	CHASE

1 spot	$15,200	Dec 23rd	Dec 30th - Jan 7th	4 Years 1 Months	$505	4	

ID: 30758

	CITIBANK

1 spot	$11,600	Dec 23rd	Dec 30th - Jan 7th	2 Years 3 Months	$360	2	

ID: 30579`;

const lines = rawData.split('\n').filter(line => line.trim());
const parsedRows = [];
let currentLender = '';

for (let i = 0; i < lines.length; i++) {
  const line = lines[i].trim();
  
  if (line && !line.includes('$') && !line.includes('spot') && !line.includes('ID:') && !line.includes('Original Price:') && line.length > 2) {
    if (line.match(/^[A-Z][A-Z\s&]+$/) || line === 'Bank of America' || line === 'Alliant CU' || line === 'NFCU' || line === 'WELLS FARGO') {
      currentLender = line.trim();
      continue;
    }
  }
  
  if (line.includes('spot') && line.includes('$')) {
    let cleanLine = line.split('Original Price:')[0].trim();
    const parts = cleanLine.split('\t').filter(p => p.trim());
    
    if (parts.length >= 6) {
      const spots = parseSpots(parts[0]);
      const limit = parseMoney(parts[1]);
      const statementDay = extractStatementDay(parts[2]);
      const posting = parts[3];
      const ageMonths = parseAge(parts[4]);
      const price = parseMoney(parts[5]);
      
      if (currentLender) {
        parsedRows.push({
          price,
          spots,
          lender: currentLender,
          limit,
          ageMonths,
          statementDay,
          posting
        });
      }
    }
  }
}

const originalRows = parsedRows;

const rows = originalRows.map(item => ({
  ...item,
  price: item.price + 200
}));

const tbody=document.querySelector('#linesTable tbody')
const totalCount=document.getElementById('totalCount')
let sortState={key:null,asc:true}

let currentUser = null;
let users = JSON.parse(localStorage.getItem('tradelineUsers')) || [];
let userOrders = JSON.parse(localStorage.getItem('userOrders')) || [];

let cart = [];
const cartModal = document.getElementById('cartModal');
const cartCount = document.getElementById('cartCount');
const cartItems = document.getElementById('cartItems');
const cartTotal = document.getElementById('cartTotal');

function formatMoney(v){return '$'+v.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:2})}
function formatLimit(v){return '$'+v.toLocaleString()}
function formatAge(months){const y=Math.floor(months/12),m=months%12;return `${y} ${y===1?'year':'years'} ${m} ${m===1?'month':'months'}`}

function registerUser(userData) {
  if (users.find(user => user.email === userData.email)) {
    return { success: false, message: 'User with this email already exists' };
  }
  
  if (users.find(user => user.phone === userData.phone)) {
    return { success: false, message: 'User with this phone number already exists' };
  }
  
  if (userData.password !== userData.confirmPassword) {
    return { success: false, message: 'Passwords do not match' };
  }
  
  const newUser = {
    id: Date.now(),
    firstName: userData.firstName,
    lastName: userData.lastName,
    phone: userData.phone,
    email: userData.email,
    password: userData.password,
    createdAt: new Date().toISOString()
  };
  
  users.push(newUser);
  localStorage.setItem('tradelineUsers', JSON.stringify(users));
  
  return { success: true, message: 'Registration successful!' };
}

function loginUser(email, phone, password) {
  const user = users.find(u => u.email === email && u.phone === phone && u.password === password);
  
  if (user) {
    currentUser = user;
    localStorage.setItem('currentUser', JSON.stringify(user));
    return { success: true, message: 'Login successful!' };
  } else {
    return { success: false, message: 'Invalid email, phone number or password' };
  }
}

function logoutUser() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  updateAuthUI();
}

function updateAuthUI() {
  const userInfo = document.getElementById('userInfo');
  const authButtons = document.getElementById('authButtons');
  const userName = document.getElementById('userName');
  
  if (currentUser) {
    userInfo.style.display = 'flex';
    authButtons.style.display = 'none';
    userName.textContent = `${currentUser.firstName} ${currentUser.lastName}`;
  } else {
    userInfo.style.display = 'none';
    authButtons.style.display = 'flex';
  }
}

function showNotification(message, isError = false) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed; top: 20px; right: 20px; z-index: 1001;
    background: ${isError ? 'var(--danger)' : 'var(--accent)'}; color: white; padding: 12px 20px;
    border-radius: 8px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}


function addOrder(orderData) {
  const order = {
    id: Date.now(),
    userId: currentUser.id,
    items: orderData.items,
    total: orderData.total,
    date: new Date().toISOString(),
    status: 'completed'
  };
  userOrders.push(order);
  localStorage.setItem('userOrders', JSON.stringify(userOrders));
}

function loadUserOrders() {
  if (!currentUser) return [];
  return userOrders.filter(order => order.userId === currentUser.id);
}

function updateProfileDisplay() {
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  
  document.getElementById('cartItemsCount').textContent = totalItems;
  document.getElementById('cartTotalAmount').textContent = totalAmount.toFixed(2);
  
  const orders = loadUserOrders();
  const ordersList = document.getElementById('ordersList');
  if (orders.length === 0) {
    ordersList.innerHTML = '<p class="no-data">No orders yet</p>';
  } else {
    ordersList.innerHTML = orders.map(order => `
      <div class="order-item">
        <div class="order-info">
          <div><strong>Order #${order.id}</strong></div>
          <div class="order-date">${new Date(order.date).toLocaleDateString()}</div>
        </div>
        <div class="order-amount">$${order.total.toFixed(2)}</div>
      </div>
    `).join('');
  }
  
}

function addToCart(item) {
  const existingItem = cart.find(cartItem => 
    cartItem.lender === item.lender && 
    cartItem.limit === item.limit && 
    cartItem.statementDay === item.statementDay
  );
  
  if (existingItem) {
    existingItem.quantity += 1;
  } else {
    cart.push({...item, quantity: 1});
  }
  
  updateCartDisplay();
  showCartNotification();
  
  if (document.getElementById('profileModal').style.display === 'block') {
    updateProfileDisplay();
  }
}

function removeFromCart(index) {
  cart.splice(index, 1);
  updateCartDisplay();
  
  if (document.getElementById('profileModal').style.display === 'block') {
    updateProfileDisplay();
  }
}

function clearCart() {
  cart = [];
  updateCartDisplay();
  
  if (document.getElementById('profileModal').style.display === 'block') {
    updateProfileDisplay();
  }
}

function updateCartDisplay() {
  cartCount.textContent = cart.length;
  
  if (cart.length === 0) {
    cartItems.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px;">Cart is empty</p>';
    cartTotal.textContent = '0.00';
    return;
  }
  
  let total = 0;
  cartItems.innerHTML = cart.map((item, index) => {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;
    return `
      <div class="cart-item">
        <div class="cart-item-info">
          <div><strong>${item.lender}</strong> - ${formatLimit(item.limit)}</div>
          <div class="muted">${item.statementDay} • ${item.posting} • ${formatAge(item.ageMonths)}</div>
          <div>Quantity: ${item.quantity}</div>
        </div>
        <div>
          <div class="cart-item-price">${formatMoney(itemTotal)}</div>
          <button class="cart-item-remove" onclick="removeFromCart(${index})">Remove</button>
        </div>
      </div>
    `;
  }).join('');
  
  cartTotal.textContent = total.toFixed(2);
}

function showCartNotification() {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed; top: 20px; right: 20px; z-index: 1001;
    background: var(--accent); color: white; padding: 12px 20px;
    border-radius: 8px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  `;
  notification.textContent = 'Item added to cart!';
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

let favorites = JSON.parse(localStorage.getItem('tradelineFavorites')) || [];
let compareItems = JSON.parse(localStorage.getItem('tradelineCompare')) || [];
let viewHistory = JSON.parse(localStorage.getItem('tradelineHistory')) || [];

function isFavorite(item){
  return favorites.some(f=>
    f.lender===item.lender&&
    f.limit===item.limit&&
    f.statementDay===item.statementDay&&
    f.posting===item.posting&&
    f.ageMonths===item.ageMonths&&
    f.price===item.price
  );
}

function isInCompare(item){
  return compareItems.some(c=>
    c.lender===item.lender&&
    c.limit===item.limit&&
    c.statementDay===item.statementDay&&
    c.posting===item.posting&&
    c.ageMonths===item.ageMonths&&
    c.price===item.price
  );
}

function toggleFavorite(item){
  const index = favorites.findIndex(f=>
    f.lender===item.lender&&
    f.limit===item.limit&&
    f.statementDay===item.statementDay&&
    f.posting===item.posting&&
    f.ageMonths===item.ageMonths&&
    f.price===item.price
  );
  if(index>=0){
    favorites.splice(index,1);
  }else{
    favorites.push(item);
  }
  localStorage.setItem('tradelineFavorites',JSON.stringify(favorites));
  render(filterData());
}

function toggleCompare(item){
  const index = compareItems.findIndex(c=>
    c.lender===item.lender&&
    c.limit===item.limit&&
    c.statementDay===item.statementDay&&
    c.posting===item.posting&&
    c.ageMonths===item.ageMonths&&
    c.price===item.price
  );
  if(index>=0){
    compareItems.splice(index,1);
  }else{
    if(compareItems.length>=5){
      showNotification('Maximum 5 items can be compared',true);
      return;
    }
    compareItems.push(item);
  }
  localStorage.setItem('tradelineCompare',JSON.stringify(compareItems));
  updateCompareBar();
  render(filterData());
}

function addToHistory(item){
  const existing = viewHistory.findIndex(h=>
    h.lender===item.lender&&
    h.limit===item.limit&&
    h.statementDay===item.statementDay&&
    h.posting===item.posting&&
    h.ageMonths===item.ageMonths&&
    h.price===item.price
  );
  if(existing>=0) viewHistory.splice(existing,1);
  viewHistory.unshift({...item,viewedAt:Date.now()});
  if(viewHistory.length>20) viewHistory = viewHistory.slice(0,20);
  localStorage.setItem('tradelineHistory',JSON.stringify(viewHistory));
}

function render(data){
  if(data.length===0){
    tbody.innerHTML='<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">🔍</div><h3>No results found</h3><p>Try adjusting your filters or search terms</p><button class="btn" onclick="resetAllFilters()">Reset Filters</button></div></td></tr>';
    const mobileCards = document.getElementById('mobileCards');
    if(mobileCards) mobileCards.innerHTML='<div class="empty-state"><div class="empty-state-icon">🔍</div><h3>No results found</h3><p>Try adjusting your filters</p><button class="btn" onclick="resetAllFilters()">Reset Filters</button></div>';
    if(totalCount) totalCount.textContent='0';
    return;
  }
  if (!tbody) return;
  tbody.innerHTML='';
  const mobileCards = document.getElementById('mobileCards');
  if (mobileCards) mobileCards.innerHTML='';
  data.forEach((r, index)=>{
    const itemId = `${r.lender}_${r.limit}_${r.statementDay}`;
    const favClass = isFavorite(r)?'active':'';
    const compClass = isInCompare(r)?'active':'';
    const tr=document.createElement('tr');
    tr.className='fade-in';
    tr.innerHTML=`
      <td>${r.lender}</td>
      <td>${formatLimit(r.limit)}</td>
      <td>${r.statementDay}</td>
      <td>${r.posting}</td>
      <td>${formatAge(r.ageMonths)}</td>
      <td>${formatMoney(r.price)}</td>
      <td>
        <div class="action-buttons">
          <button class="favorite-btn ${favClass}" onclick="toggleFavorite(${JSON.stringify(r).replace(/"/g, '&quot;')})" title="Add to favorites">⭐</button>
          <button class="compare-btn ${compClass}" onclick="toggleCompare(${JSON.stringify(r).replace(/"/g, '&quot;')})" title="Add to compare">⚖️</button>
          <button class="btn" onclick="addToCart(${JSON.stringify(r).replace(/"/g, '&quot;')})">Add</button>
        </div>
      </td>`;
    tbody.appendChild(tr);
    if (mobileCards) {
      const card = document.createElement('div');
      card.className = 'mobile-card';
      const itemData = JSON.stringify(r).replace(/"/g, '&quot;');
      card.innerHTML=`
        <div class="mobile-card-header">
          <div class="mobile-card-title">${r.lender}</div>
          <div class="mobile-card-price">${formatMoney(r.price)}</div>
        </div>
        <div class="mobile-card-row">
          <span class="mobile-card-label">Limit:</span>
          <span class="mobile-card-value">${formatLimit(r.limit)}</span>
        </div>
        <div class="mobile-card-row">
          <span class="mobile-card-label">Statement Day:</span>
          <span class="mobile-card-value">${r.statementDay}</span>
        </div>
        <div class="mobile-card-row">
          <span class="mobile-card-label">Posting Day:</span>
          <span class="mobile-card-value">${r.posting}</span>
        </div>
        <div class="mobile-card-row">
          <span class="mobile-card-label">Account Age:</span>
          <span class="mobile-card-value">${formatAge(r.ageMonths)}</span>
        </div>
        <div class="mobile-card-action">
          <div class="action-buttons" style="display:flex;gap:8px;">
            <button class="favorite-btn ${favClass}" onclick="toggleFavorite(${itemData})" style="flex:1;">⭐ Favorite</button>
            <button class="compare-btn ${compClass}" onclick="toggleCompare(${itemData})" style="flex:1;">⚖️ Compare</button>
          </div>
          <button class="btn" onclick="addToCart(${itemData})" style="width:100%;margin-top:8px;">Add to Cart</button>
        </div>
      `;
      mobileCards.appendChild(card);
    }
    addToHistory(r);
  });
  if (totalCount) totalCount.textContent=data.length;
}

function sortBy(key){if(sortState.key===key){sortState.asc=!sortState.asc}else{sortState={key,asc:true}}
  const sorted=[...filteredRows()].sort((a,b)=>{let va=a[key],vb=b[key];
    if(typeof va==='string'){va=va.toLowerCase();vb=vb.toLowerCase()}
    if(va<vb)return sortState.asc?-1:1
    if(va>vb)return sortState.asc?1:-1
    return 0
  })
  render(sorted)
}

function parseRange(val){if(!val)return null; const trimmed=val.trim();if(trimmed.endsWith('+')){const num=parseInt(trimmed.replace('+','').trim());return{min:num,max:Infinity}} const [min,max]=trimmed.split('-').map(x=>parseInt(x.trim()));return{min,max}}

function inRange(value,range){if(!range)return true;return value>=range.min&&value<=range.max}

function filterData(){const q=document.getElementById('searchInput').value.trim().toLowerCase()
  const priceEl=document.getElementById('priceSelect')||document.getElementById('mobilePriceSelect')
  const limitEl=document.getElementById('limitSelect')||document.getElementById('mobileLimitSelect')
  const ageEl=document.getElementById('ageSelect')||document.getElementById('mobileAgeSelect')
  const lenderEl=document.getElementById('lenderSelect')||document.getElementById('mobileLenderSelect')
  const statementEl=document.getElementById('statementSelect')||document.getElementById('mobileStatementSelect')
  const postingEl=document.getElementById('postingInput')||document.getElementById('mobilePostingInput')
  const priceR=parseRange((priceEl?.value||'').replace(/[$ ,]/g,'').replace(' +','+'))
  const limitR=parseRange((limitEl?.value||'').replace(/[$ ,]/g,'').replace(' +','+'))
  const ageR=(ageEl?.value||'').replace(' +','+')
  let ageRange=ageR?parseRange(ageR):null
  if(ageRange){
    ageRange={min:ageRange.min*12,max:ageRange.max===Infinity?Infinity:ageRange.max*12}
  }
  const lender=lenderEl?.value||''
  const statement=statementEl?.value||''
  const posting=(postingEl?.value||'').trim().toLowerCase()
  return rows.filter(r=>{
    const ageOk=!ageRange||inRange(r.ageMonths,ageRange)
    const priceOk=!priceR||inRange(r.price,priceR)
    const limitOk=!limitR||inRange(r.limit,limitR)
    const lenderOk=!lender||r.lender===lender
    const statOk=!statement||r.statementDay===statement
    const postOk=!posting||r.posting.toLowerCase().includes(posting)
    const qOk=!q||[r.lender,formatLimit(r.limit),r.statementDay,r.posting].join(' ').toLowerCase().includes(q)
    return ageOk&&priceOk&&limitOk&&lenderOk&&statOk&&postOk&&qOk
  })
}

function filteredRows(){return filterData()}

document.querySelectorAll('th.sortable').forEach(th=>{th.addEventListener('click',()=>sortBy(th.dataset.key))})

function syncFilters(sourceId, targetId) {
  const source = document.getElementById(sourceId);
  const target = document.getElementById(targetId);
  if (source && target) {
    target.value = source.value;
  }
}


const filterSync = (desktopId, mobileId) => {
  const desktop = document.getElementById(desktopId);
  const mobile = document.getElementById(mobileId);
  if (desktop) {
    desktop.addEventListener('change', () => {
      if (mobile) mobile.value = desktop.value;
      render(filterData());
      saveFilterState();
    });
  }
  if (mobile) {
    mobile.addEventListener('change', () => {
      if (desktop) desktop.value = mobile.value;
      render(filterData());
      saveFilterState();
    });
  }
};

filterSync('lenderSelect', 'mobileLenderSelect');
filterSync('limitSelect', 'mobileLimitSelect');
filterSync('statementSelect', 'mobileStatementSelect');
filterSync('postingInput', 'mobilePostingInput');
filterSync('ageSelect', 'mobileAgeSelect');
filterSync('priceSelect', 'mobilePriceSelect');

document.getElementById('postingInput')?.addEventListener('input', () => {
  const mobile = document.getElementById('mobilePostingInput');
  if (mobile) mobile.value = document.getElementById('postingInput').value;
  render(filterData());
  saveFilterState();
});

document.getElementById('mobilePostingInput')?.addEventListener('input', () => {
  const desktop = document.getElementById('postingInput');
  if (desktop) desktop.value = document.getElementById('mobilePostingInput').value;
  render(filterData());
  saveFilterState();
});

function resetAllFilters(){
  document.querySelectorAll('input,select').forEach(el=>{
    if(el.id!=='resetFilters'&&el.id!=='mobileResetFilters')el.value=''
  })
  sortState={key:null,asc:true};
  render(rows);
  saveFilterState();
}

document.getElementById('resetFilters').addEventListener('click',resetAllFilters)

document.getElementById('mobileResetFilters').addEventListener('click',resetAllFilters)

document.getElementById('cartIcon').addEventListener('click', () => {
  cartModal.style.display = 'block';
  updateCartDisplay();
});

document.getElementById('closeCart').addEventListener('click', () => {
  cartModal.style.display = 'none';
});

document.getElementById('clearCart').addEventListener('click', () => {
  clearCart();
});

document.getElementById('checkout').addEventListener('click', () => {
  if (cart.length === 0) {
    alert('Cart is empty!');
    return;
  }
  
  if (!currentUser) {
    cartModal.style.display = 'none';
    showNotification('You need to login to place an order', true);
    setTimeout(() => {
      document.getElementById('loginModal').style.display = 'block';
    }, 1000);
    return;
  }
  
  const totalAmount = parseFloat(cartTotal.textContent);
  
  let telegramMessage = `🛒 *TRADELINES.SHOP Order*\n\n`;
  telegramMessage += `👤 *Customer Details:*\n`;
  telegramMessage += `   📝 Name: ${currentUser.firstName} ${currentUser.lastName}\n`;
  telegramMessage += `   📞 Phone: ${currentUser.phone}\n`;
  telegramMessage += `   📧 Email: ${currentUser.email}\n\n`;
  telegramMessage += `💰 *Total Amount: $${totalAmount.toFixed(2)}*\n\n`;
  telegramMessage += `📋 *Items:*\n`;
  
  cart.forEach((item, index) => {
    telegramMessage += `${index + 1}. *${item.lender}*\n`;
    telegramMessage += `   💳 Limit: ${formatLimit(item.limit)}\n`;
    telegramMessage += `   📅 Statement Day: ${item.statementDay}\n`;
    telegramMessage += `   📆 Posting: ${item.posting}\n`;
    telegramMessage += `   ⏰ Age: ${formatAge(item.ageMonths)}\n`;
    telegramMessage += `   💵 Price: ${formatMoney(item.price)} x ${item.quantity} = ${formatMoney(item.price * item.quantity)}\n\n`;
  });
  
  telegramMessage += `\n📞 Please process this order.`;
  
  const telegramLink = `https://t.me/Laxcredit?text=${encodeURIComponent(telegramMessage)}`;
  
  window.open(telegramLink, '_blank');
  
  addOrder({
    items: cart.map(item => ({
      lender: item.lender,
      limit: item.limit,
      statementDay: item.statementDay,
      posting: item.posting,
      ageMonths: item.ageMonths,
      spots: item.spots,
      price: item.price,
      quantity: item.quantity
    })),
    total: totalAmount
  });
  
  clearCart();
  cartModal.style.display = 'none';
  
  document.getElementById('confirmationModal').style.display = 'block';
});

window.addEventListener('click', (event) => {
  if (event.target === cartModal) {
    cartModal.style.display = 'none';
  }
});

document.getElementById('loginBtn').addEventListener('click', () => {
  document.getElementById('loginModal').style.display = 'block';
});

document.getElementById('registerBtn').addEventListener('click', () => {
  document.getElementById('registerModal').style.display = 'block';
});

document.getElementById('showRegister').addEventListener('click', () => {
  document.getElementById('loginModal').style.display = 'none';
  document.getElementById('registerModal').style.display = 'block';
});

document.getElementById('showLogin').addEventListener('click', () => {
  document.getElementById('registerModal').style.display = 'none';
  document.getElementById('loginModal').style.display = 'block';
});

document.getElementById('closeLogin').addEventListener('click', () => {
  document.getElementById('loginModal').style.display = 'none';
});

document.getElementById('closeRegister').addEventListener('click', () => {
  document.getElementById('registerModal').style.display = 'none';
});

document.getElementById('profileBtn').addEventListener('click', () => {
  updateProfileDisplay();
  document.getElementById('profileModal').style.display = 'block';
});

document.getElementById('closeProfile').addEventListener('click', () => {
  document.getElementById('profileModal').style.display = 'none';
});

document.getElementById('closeConfirmation').addEventListener('click', () => {
  document.getElementById('confirmationModal').style.display = 'none';
});

document.getElementById('okConfirmation').addEventListener('click', () => {
  document.getElementById('confirmationModal').style.display = 'none';
});

window.addEventListener('click', (event) => {
  const confirmationModal = document.getElementById('confirmationModal');
  if (event.target === confirmationModal) {
    confirmationModal.style.display = 'none';
  }
});

document.getElementById('sendConfirmationBtn').addEventListener('click', () => {
  if (cart.length === 0) {
    showNotification('Cart is empty!', true);
    return;
  }
  
  if (!currentUser) {
    showNotification('Please login first', true);
    return;
  }
  
  const totalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  
  let telegramMessage = `🛒 *TRADELINES.SHOP Payment Confirmation*\n\n`;
  telegramMessage += `👤 *Customer Details:*\n`;
  telegramMessage += `   📝 Name: ${currentUser.firstName} ${currentUser.lastName}\n`;
  telegramMessage += `   📞 Phone: ${currentUser.phone}\n`;
  telegramMessage += `   📧 Email: ${currentUser.email}\n\n`;
  telegramMessage += `💰 *Total Amount: $${totalAmount.toFixed(2)}*\n\n`;
  telegramMessage += `📋 *Items:*\n`;
  
  cart.forEach((item, index) => {
    telegramMessage += `${index + 1}. *${item.lender}*\n`;
    telegramMessage += `   💳 Limit: $${item.limit.toLocaleString()}\n`;
    telegramMessage += `   📅 Statement Day: ${item.statementDay}\n`;
    telegramMessage += `   📆 Posting: ${item.posting}\n`;
    telegramMessage += `   ⏰ Age: ${formatAge(item.ageMonths)}\n`;
    telegramMessage += `   💵 Price: ${formatMoney(item.price)} x ${item.quantity} = ${formatMoney(item.price * item.quantity)}\n\n`;
  });
  
  telegramMessage += `\n📞 Please process this order.`;
  
  const telegramLink = `https://t.me/Laxcredit?text=${encodeURIComponent(telegramMessage)}`;
  
  window.open(telegramLink, '_blank');
  
  addOrder({
    items: cart.map(item => ({
      lender: item.lender,
      limit: item.limit,
      statementDay: item.statementDay,
      posting: item.posting,
      ageMonths: item.ageMonths,
      spots: item.spots,
      price: item.price,
      quantity: item.quantity
    })),
    total: totalAmount
  });
  
  clearCart();
  
  updateProfileDisplay();
  
  document.getElementById('confirmationModal').style.display = 'block';
});


document.getElementById('logoutBtn').addEventListener('click', () => {
  logoutUser();
  showNotification('You have logged out');
});

document.getElementById('loginForm').addEventListener('submit', (e) => {
  e.preventDefault();
  
  const email = document.getElementById('loginEmail').value;
  const phone = document.getElementById('loginPhone').value;
  const password = document.getElementById('loginPassword').value;
  
  const result = loginUser(email, phone, password);
  
  if (result.success) {
    updateAuthUI();
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('loginForm').reset();
    showNotification(result.message);
  } else {
    showNotification(result.message, true);
  }
});


document.getElementById('registerForm').addEventListener('submit', (e) => {
  e.preventDefault();
  
  const userData = {
    firstName: document.getElementById('regFirstName').value,
    lastName: document.getElementById('regLastName').value,
    phone: document.getElementById('regPhone').value,
    email: document.getElementById('regEmail').value,
    password: document.getElementById('regPassword').value,
    confirmPassword: document.getElementById('regConfirmPassword').value
  };
  
  const result = registerUser(userData);
  
  if (result.success) {
    document.getElementById('registerModal').style.display = 'none';
    document.getElementById('registerForm').reset();
    showNotification(result.message);
  } else {
    showNotification(result.message, true);
  }
});

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab + 'Tab').classList.add('active');
  });
});

document.getElementById('addFundsForm').addEventListener('submit', (e) => {
  e.preventDefault();
  
  const amount = parseFloat(document.getElementById('amount').value);
  const method = document.getElementById('paymentMethod').value;
  
  if (amount < 10) {
    showNotification('Minimum amount is $10', true);
    return;
  }
  
  addPayment(amount, method);
  updateProfileDisplay();
  document.getElementById('addFundsModal').style.display = 'none';
  document.getElementById('addFundsForm').reset();
  showNotification(`Successfully added $${amount.toFixed(2)} to your balance!`);
});





function updateCompareBar(){
  const compareBar = document.getElementById('compareBar');
  const compareItemsEl = document.getElementById('compareItems');
  if(!compareBar||!compareItemsEl) return;
  if(compareItems.length===0){
    compareBar.classList.remove('active');
    return;
  }
  compareBar.classList.add('active');
  compareItemsEl.innerHTML = compareItems.map((item,index)=>`
    <div class="compare-item">
      <div class="compare-item-header">
        <div class="compare-item-title">${item.lender}</div>
        <button class="compare-item-remove" onclick="removeFromCompare(${index})">×</button>
      </div>
      <div style="font-size:12px;color:var(--muted);">${formatLimit(item.limit)} • ${item.statementDay}</div>
      <div style="font-weight:600;color:var(--accent-600);margin-top:4px;">${formatMoney(item.price)}</div>
    </div>
  `).join('');
}

function removeFromCompare(index){
  compareItems.splice(index,1);
  localStorage.setItem('tradelineCompare',JSON.stringify(compareItems));
  updateCompareBar();
  render(filterData());
}

function showCompareModal(){
  if(compareItems.length===0){
    showNotification('No items to compare',true);
    return;
  }
  const compareTable = document.getElementById('compareTable');
  const headers = ['Lender','Limit','Statement Day','Posting Day','Account Age','Price'];
  let html = '<table style="width:100%;border-collapse:collapse;"><thead><tr>';
  headers.forEach(h=>html+=`<th style="padding:12px;border:1px solid var(--border);background:var(--accent-50);">${h}</th>`);
  html+='</tr></thead><tbody>';
  compareItems.forEach(item=>{
    html+=`<tr><td style="padding:12px;border:1px solid var(--border);">${item.lender}</td>`;
    html+=`<td style="padding:12px;border:1px solid var(--border);">${formatLimit(item.limit)}</td>`;
    html+=`<td style="padding:12px;border:1px solid var(--border);">${item.statementDay}</td>`;
    html+=`<td style="padding:12px;border:1px solid var(--border);">${item.posting}</td>`;
    html+=`<td style="padding:12px;border:1px solid var(--border);">${formatAge(item.ageMonths)}</td>`;
    html+=`<td style="padding:12px;border:1px solid var(--border);">${formatMoney(item.price)}</td></tr>`;
  });
  html+='</tbody></table>';
  compareTable.innerHTML = html;
  document.getElementById('compareModal').style.display='block';
}

function exportToCSV(){
  const data = filterData();
  if(data.length===0){
    showNotification('No data to export',true);
    return;
  }
  const headers = ['Lender','Limit','Statement Day','Posting Day','Account Age','Price'];
  let csv = headers.join(',')+'\n';
  data.forEach(item=>{
    csv+=`${item.lender},${formatLimit(item.limit)},${item.statementDay},"${item.posting}",${formatAge(item.ageMonths)},${formatMoney(item.price)}\n`;
  });
  const blob = new Blob([csv],{type:'text/csv'});
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `tradelines_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  window.URL.revokeObjectURL(url);
  showNotification('Data exported successfully!');
}


function saveFilterState(){
  const state = {
    lender:document.getElementById('lenderSelect')?.value||'',
    limit:document.getElementById('limitSelect')?.value||'',
    statement:document.getElementById('statementSelect')?.value||'',
    age:document.getElementById('ageSelect')?.value||'',
    price:document.getElementById('priceSelect')?.value||'',
    posting:document.getElementById('postingInput')?.value||'',
    search:document.getElementById('searchInput')?.value||''
  };
  localStorage.setItem('tradelineFilters',JSON.stringify(state));
}

function loadFilterState(){
  const saved = localStorage.getItem('tradelineFilters');
  if(!saved) return;
  const state = JSON.parse(saved);
  if(state.lender) document.getElementById('lenderSelect').value = state.lender;
  if(state.limit) document.getElementById('limitSelect').value = state.limit;
  if(state.statement) document.getElementById('statementSelect').value = state.statement;
  if(state.age) document.getElementById('ageSelect').value = state.age;
  if(state.price) document.getElementById('priceSelect').value = state.price;
  if(state.posting) document.getElementById('postingInput').value = state.posting;
  if(state.search) document.getElementById('searchInput').value = state.search;
  syncFilters('lenderSelect','mobileLenderSelect');
  syncFilters('limitSelect','mobileLimitSelect');
  syncFilters('statementSelect','mobileStatementSelect');
  syncFilters('ageSelect','mobileAgeSelect');
  syncFilters('priceSelect','mobilePriceSelect');
  syncFilters('postingInput','mobilePostingInput');
  render(filterData());
}

function showFavoritesModal(){
  const favoritesList = document.getElementById('favoritesList');
  if(favorites.length===0){
    favoritesList.innerHTML='<div class="empty-state"><div class="empty-state-icon">⭐</div><h3>No favorites yet</h3><p>Add items to favorites by clicking the star icon</p></div>';
  }else{
    favoritesList.innerHTML = favorites.map(item=>`
      <div class="favorite-item" onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})">
        <div>
          <strong>${item.lender}</strong> - ${formatLimit(item.limit)}<br>
          <small class="muted">${item.statementDay} • ${formatAge(item.ageMonths)}</small>
        </div>
        <div style="font-weight:600;color:var(--accent-600);">${formatMoney(item.price)}</div>
      </div>
    `).join('');
  }
  document.getElementById('favoritesModal').style.display='block';
}

function showHistoryModal(){
  const historyList = document.getElementById('historyList');
  if(viewHistory.length===0){
    historyList.innerHTML='<div class="empty-state"><div class="empty-state-icon">📜</div><h3>No view history</h3><p>Your recently viewed items will appear here</p></div>';
  }else{
    historyList.innerHTML = viewHistory.slice(0,10).map(item=>`
      <div class="history-item" onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})">
        <div>
          <strong>${item.lender}</strong> - ${formatLimit(item.limit)}<br>
          <small class="muted">${item.statementDay} • ${formatAge(item.ageMonths)}</small>
        </div>
        <div style="font-weight:600;color:var(--accent-600);">${formatMoney(item.price)}</div>
      </div>
    `).join('');
  }
  document.getElementById('historyModal').style.display='block';
}

function showLoading(){
  document.getElementById('loadingOverlay').classList.add('active');
}

function hideLoading(){
  document.getElementById('loadingOverlay').classList.remove('active');
}

document.getElementById('exportCSV').addEventListener('click',exportToCSV);
document.getElementById('compareNow').addEventListener('click',showCompareModal);
document.getElementById('clearCompare').addEventListener('click',()=>{
  compareItems=[];
  localStorage.setItem('tradelineCompare',JSON.stringify(compareItems));
  updateCompareBar();
  render(filterData());
});
document.getElementById('closeCompare').addEventListener('click',()=>{
  document.getElementById('compareModal').style.display='none';
});
document.getElementById('closeFavorites').addEventListener('click',()=>{
  document.getElementById('favoritesModal').style.display='none';
});
document.getElementById('closeHistory').addEventListener('click',()=>{
  document.getElementById('historyModal').style.display='none';
});
document.getElementById('favoritesBtn').addEventListener('click',showFavoritesModal);
document.getElementById('historyBtn').addEventListener('click',showHistoryModal);

let searchTimeout;
document.getElementById('searchInput').addEventListener('input',(e)=>{
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(()=>{
    render(filterData());
    saveFilterState();
  },300);
});

const filterElements = ['lenderSelect','limitSelect','statementSelect','ageSelect','priceSelect','postingInput','mobileLenderSelect','mobileLimitSelect','mobileStatementSelect','mobileAgeSelect','mobilePriceSelect','mobilePostingInput'];
filterElements.forEach(id=>{
  const el = document.getElementById(id);
  if(el) el.addEventListener('change',()=>{
    saveFilterState();
  });
});

const savedUser = localStorage.getItem('currentUser');
if (savedUser) {
  currentUser = JSON.parse(savedUser);
  updateAuthUI();
}

loadFilterState();
updateCompareBar();
render(rows);
</script>
<button id="scrollToTop" class="scroll-to-top" title="Наверх">↑</button>
<script>
(function(){
  const scrollToTopBtn = document.getElementById('scrollToTop');
  if(!scrollToTopBtn) return;
  
  function toggleScrollButton(){
    if(window.pageYOffset>300){
      scrollToTopBtn.classList.add('visible');
    }else{
      scrollToTopBtn.classList.remove('visible');
    }
  }
  
  window.addEventListener('scroll',toggleScrollButton);
  scrollToTopBtn.addEventListener('click',()=>{
    window.scrollTo({top:0,behavior:'smooth'});
  });
  
  toggleScrollButton();
})();
</script>
</body>
</html>
